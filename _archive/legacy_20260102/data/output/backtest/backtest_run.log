======================================================================
로그 파일: E:\AI Study\krx_alertor_modular\logs\backtest\phase3_train_val_test_20251205_230002.log
시작 시간: 2025-12-05 23:00:02
======================================================================
======================================================================
Phase 3: Train/Val/Test 3-way 분리 백테스트
======================================================================
목적: 과최적화 방지 + 실전 성과 예측

1. 유니버스 로드
----------------------------------------------------------------------
유니버스 크기: 81개
KODEX 200 (069500) 추가 - KOSPI 대표
종목 코드: ['69500', '459580', '102110', '411060', '91160', '396500', '466920', '229200', '360750', '305720']... (총 82개)

2. 가격 데이터 로드
----------------------------------------------------------------------
명령줄 인자: start_date=2022-01-01, end_date=2025-11-08
기간: 2022-01-01 ~ 2025-11-08
데이터 로딩 중...
[OK] 데이터 로드 완료
   Shape: (52501, 8)

종목별 데이터 수:
  평균: 729일
  최소: 4일
  최대: 1882일

3. 전략 설정
----------------------------------------------------------------------
기본 파라미터 사용:
  ma_period: 60
  rsi_period: 14
  rsi_overbought: 70
  maps_buy_threshold: 0.0
  maps_sell_threshold: -5.0
[OK] 전략 초기화 완료

4. Train/Val/Test 분리 백테스트
----------------------------------------------------------------------

4.1 기간 분리 확인 (70/15/15)
----------------------------------------
  Train: 2022-01-01 ~ 2024-09-11 (984일)
  Val: 2024-09-12 ~ 2025-04-10 (210일)
  Test: 2025-04-11 ~ 2025-11-08 (211일)

4.2 어댑터 생성
----------------------------------------
[OK] 어댑터 생성 완료

4.3 Train/Val/Test 분리 백테스트 실행
----------------------------------------
종목 0117V0: 데이터 부족 (14일)
종목 0123G0: 데이터 부족 (4일)
포트폴리오 손절 발동! 최고가치=11,227,211 현재가치=9,525,660 손실=-15.16%
포트폴리오 손절 발동! 2023-08-11
단일 급락 감지! 2024-08-05: 당일 Low -11.40%
방어 모드 진입! 2024-08-05: single_day_crash_-11.40%
시장 급락 감지! 2024-08-05: single_day_crash_-11.40%
종목 0117V0: 데이터 부족 (14일)
종목 0123G0: 데이터 부족 (4일)
단일 급락 감지! 2025-04-07: 당일 Low -6.14%
방어 모드 진입! 2025-04-07: single_day_crash_-6.14%
시장 급락 감지! 2025-04-07: single_day_crash_-6.14%
종목 0117V0: 데이터 부족 (14일)
종목 0123G0: 데이터 부족 (4일)
단일 급락 감지! 2025-11-05: 당일 Low -6.54%
방어 모드 진입! 2025-11-05: single_day_crash_-6.54%
시장 급락 감지! 2025-11-05: single_day_crash_-6.54%
[OK] Train/Val/Test 분리 백테스트 완료!

5. 결과 비교
----------------------------------------------------------------------

======================================================================
[결과] Train/Val/Test 비교 결과
======================================================================

[기간]
  Train: 2022-01-01 ~ 2024-09-11 (984일)
  Val: 2024-09-12 ~ 2025-04-10 (210일)
  Test: 2025-04-11 ~ 2025-11-08 (211일)

[성과 비교]
----------------------------------------------------------------------
지표                          Train          Val         Test       T->V       V->T
----------------------------------------------------------------------
CAGR                      -3.44%      16.34%     108.74%    +19.78%    +92.41%
Sharpe                      -0.14         1.38         3.74      +1.52      +2.36
MDD                      -25.23%      -7.26%      -8.07%    +17.97%     -0.81%
Total Return              -8.98%       9.09%      52.67%    +18.07%    +43.58%
----------------------------------------------------------------------

[판정] [+] 개선 (시장 환경 호전)
   검증 신뢰도: low

[경고]
   [!] Val/Test 차이 큼: 565.6%
======================================================================

6. 상세 결과
----------------------------------------------------------------------

[Train 결과]
  기간: 2022-01-01 ~ 2024-09-11
  수익률: -8.98%
  CAGR: -3.44%
  Sharpe: -0.14
  MDD: -25.23%
  거래 수: 1523회
  거래비용: 1,360,747원 (13.61%)
  레짐 통계:
    - 상승장: 550일 (60.0%)
    - 하락장: 136일 (14.8%)
    - 중립장: 230일 (25.1%)

[Val 결과]
  기간: 2024-09-12 ~ 2025-04-10
  수익률: 9.09%
  CAGR: 16.34%
  Sharpe: 1.38
  MDD: -7.26%
  거래 수: 399회
  거래비용: 234,283원 (2.34%)
  레짐 통계:
    - 상승장: 0일 (0.0%)
    - 하락장: 228일 (86.0%)
    - 중립장: 37일 (14.0%)

[Test 결과]
  기간: 2025-04-11 ~ 2025-11-08
  수익률: 52.67%
  CAGR: 108.74%
  Sharpe: 3.74
  MDD: -8.07%
  거래 수: 250회
  거래비용: 338,731원 (3.39%)
  레짐 통계:
    - 상승장: 186일 (68.1%)
    - 하락장: 1일 (0.4%)
    - 중립장: 86일 (31.5%)

7. 최종 판정
----------------------------------------------------------------------
[OK] [O] [+] 개선 (시장 환경 호전)
  검증 신뢰도: low

[!] 주의사항:
  [!] Val/Test 차이 큼: 565.6%

8. 결과 저장
----------------------------------------------------------------------
[OK] 결과 저장: E:\AI Study\krx_alertor_modular\data\output\backtest\train_val_test_split_results.json
[OK] 히스토리 저장: E:\AI Study\krx_alertor_modular\data\output\backtest_history.json

9. 요약
----------------------------------------------------------------------
======================================================================
Phase 3: Train/Val/Test 3-way 분리 백테스트 완료
======================================================================

[성과 비교]
  Train CAGR: -3.44%
  Val CAGR:   16.34%
  Test CAGR:  108.74%

[판정] [+] 개선 (시장 환경 호전)
   검증 신뢰도: low
======================================================================

======================================================================
종료 시간: 2025-12-05 23:01:22
======================================================================
