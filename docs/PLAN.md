# KRX Alertor κ°λ° κ³„ν (2025-12-11 κΈ°μ¤€)

---

## β… κΈ΄κΈ‰ (μ™„λ£λ¨ - 2025-12-11)

| # | μ‘μ—… | μ„¤λ… | μƒνƒ |
|---|------|------|------|
| 1 | **Live νλΌλ―Έν„° κµ¬μ΅° κµ¬ν„** | `optimal_params.json`μ— `live` λΈ”λ΅ λ¶„λ¦¬ | β… μ™„λ£ |
| 2 | **"μ‹¤μ „ νλΌλ―Έν„°λ΅ μ μ©" λ²„νΌ** | νλ‹ UIμ—μ„ Live μΉκ²© κΈ°λ¥ | β… μ™„λ£ |
| 3 | **μΌμΌ μ¶”μ² μ•λ¦Ό μ‹ κ· κ°λ°** | Live νλΌλ―Έν„° κΈ°λ° λ§¤μ/λ§¤λ„ μ‹ νΈ | β… μ™„λ£ |

### κµ¬ν„ νμΌ
- `app/services/optimal_params_service.py` - live/live_history/research κµ¬μ΅°
- `api_backtest.py` - promote-to-live, live, rollback-live API
- `web/dashboard/src/pages/Strategy.tsx` - "μ‹¤μ „ νλΌλ―Έν„°λ΅ μ μ©" λ²„νΌ
- `core/strategy/live_signal_generator.py` - Live κΈ°λ° μ‹ νΈ μƒμ„±
- `scripts/nas/daily_recommendation_alert.py` - μΌμΌ μ¶”μ² μ•λ¦Ό

---

## β­ μ¤‘μ” (2μ£Ό λ‚΄ μ™„λ£)

| # | μ‘μ—… | μ„¤λ… | μμƒ μ‹κ°„ |
|---|------|------|-----------|
| 4 | **κΈ°μ΅΄ μ•λ¦Όμ— Live νλΌλ―Έν„° μ—°λ™** | μ¥μ‹μ‘/μΌμΌ/μ£Όκ°„ λ¦¬ν¬νΈ μμ • | 3μ‹κ°„ |
| 5 | **μ†μ  ν•©μ„± λ΅μ§** | ETF: `min(μ „λµ stop_loss, ν•μ΄λΈλ¦¬λ“)` | 2μ‹κ°„ |
| 6 | **lookback νλΌλ―Έν„° μ¶”κ°€** | `optimal_params.json`μ— λ£©λ°± κΈ°κ°„ μ €μ¥ | 1μ‹κ°„ |

---

## π“‹ μΌλ° (μ›” λ‚΄ μ™„λ£)

| # | μ‘μ—… | μ„¤λ… | μμƒ μ‹κ°„ |
|---|------|------|-----------|
| 7 | **μ¥μ¤‘ μ•λ¦Ό μ λ‹λ²„μ¤ ν•„ν„°** | ETF μ λ‹λ²„μ¤ μΆ…λ©λ§ ν‘μ‹ μµμ… | 1μ‹κ°„ |
| 8 | **Live νλΌλ―Έν„° λ΅¤λ°± κΈ°λ¥** | μ΄μ „ Liveλ΅ λ³µμ› | 2μ‹κ°„ |
| 9 | **ν„μ¬ Live ν‘μ‹ UI** | νλ‹ νμ΄μ§€μ— ν„μ¬ μ΄μ νλΌλ―Έν„° ν‘μ‹ | 1μ‹κ°„ |

---

## π”® ν–¥ν›„ (Phase 1~4)

| Phase | μ‘μ—… | μ„¤λ… |
|-------|------|------|
| 1 | μ¥κΈ° λ°±ν…μ¤νΈ κ²€μ¦ | 12κ°μ›”+ / 2022~2024 ν•λ½μ¥ κ²€μ¦ |
| 2 | Walk-Forward ν”„λ μ„μ›ν¬ | λ΅¤λ§ μλ„μ° / PSS |
| 3 | TP/SL κ³ λ„ν™” | Take Profit / Trailing Stop |
| 4 | κ³ κΈ‰ κΈ°λ¥ | Market Breadth / μ΄λ²¤νΈ μΊλ¦°λ” |

---

# μƒμ„Έ κµ¬ν„ κ³„ν

---

## 1. Live νλΌλ―Έν„° κµ¬μ΅° κµ¬ν„

### λ©ν‘
`optimal_params.json` κµ¬μ΅°λ¥Ό `live` / `live_history` / `research`λ΅ λ¶„λ¦¬

### λ³€κ²½ μ „
```json
{
  "current": { ... },
  "history": [ ... ]
}
```

### λ³€κ²½ ν›„
```json
{
  "live": {
    "params": {
      "lookback": "3M",
      "ma_period": 40,
      "rsi_period": 9,
      "stop_loss": -20,
      "max_positions": 12
    },
    "promoted_at": "2025-12-11T01:20:00",
    "source_trial_id": 3,
    "notes": "AI λ¶„μ„ ν›„ μΉκ²©"
  },
  "live_history": [
    { "params": {...}, "demoted_at": "...", "reason": "μƒ νλΌλ―Έν„°λ΅ κµμ²΄" }
  ],
  "research": [...]
}
```

### μ‘μ—… ν•­λ©
- [ ] `OptimalParamsService` μμ •: `promote_to_live()`, `load_live()`, `rollback_live()` λ©”μ„λ“ μ¶”κ°€
- [ ] κΈ°μ΅΄ `current` β†’ `live` λ§μ΄κ·Έλ μ΄μ… μ¤ν¬λ¦½νΈ
- [ ] `lookback` νλΌλ―Έν„° μ¶”κ°€

---

## 2. "μ‹¤μ „ νλΌλ―Έν„°λ΅ μ μ©" λ²„νΌ

### λ©ν‘
νλ‹ UIμ—μ„ μ„ νƒν• Trialμ„ Liveλ΅ μΉκ²©

### UI μ„μΉ
```
[μµμ  νλΌλ―Έν„° μ €μ¥] [μµμ  κ²°κ³Ό AI λ¶„μ„] [μ‹¤μ „ νλΌλ―Έν„°λ΅ μ μ©]
```

### API
```
POST /api/v1/optimal-params/promote-to-live
Body: { trial_id, params, notes }
```

### μ‘μ—… ν•­λ©
- [ ] λ°±μ—”λ“ API μ—”λ“ν¬μΈνΈ μ¶”κ°€
- [ ] ν”„λ΅ νΈμ—”λ“ λ²„νΌ λ° ν™•μΈ λ¨λ‹¬ μ¶”κ°€
- [ ] μΉκ²© μ‹ μ΄μ „ Liveλ¥Ό `live_history`λ΅ μ΄λ™

---

## 3. μΌμΌ μ¶”μ² μ•λ¦Ό μ‹ κ· κ°λ°

### λ©ν‘
Live νλΌλ―Έν„° κΈ°λ° λ§¤μ/λ§¤λ„ μ‹ νΈ μƒμ„± λ° μ•λ¦Ό

### μ•λ¦Ό ν•μ‹
```
π“ μΌμΌ μ¶”μ² (2025-12-11)
(Momentum 3M / MA40 / RSI9 κΈ°μ¤€)

π“¥ λ§¤μ κ²€ν† 
  β€Ά KODEX 200: λ©ν‘ 40.0%
  β€Ά KODEX λ°λ„μ²΄: λ©ν‘ 20.0%

π“¤ λ§¤λ„ κ²€ν† 
  β€Ά TIGER μ°¨μ΄λ‚: ν„μ¬ 15% β†’ λ©ν‘ 0%

π”§ ν„μ¬ Live: λ£©λ°± 3M / MA 40 / RSI 9 / μ†μ  -20%
```

### λ΅μ§
```
1. Live νλΌλ―Έν„° λ΅λ“ (lookback, ma_period, rsi_period, stop_loss)
2. μ λ‹λ²„μ¤ ν•„ν„°λ§ (κ±°λλ€κΈ, μƒμ¥μΌ)
3. λ¨λ©ν…€ μ¤μ½”μ–΄ κ³„μ‚° (lookback + ma_period)
4. RSI μ¤μΌ€μΌλ§ (rsi_period)
5. λ©ν‘ λΉ„μ¤‘ κ³„μ‚° (Equal-Weight or PyPortfolioOpt)
6. ν„μ¬ λ³΄μ  λΉ„μ¤‘κ³Ό λΉ„κµ
   - λ¶€μ΅± β†’ λ§¤μ κ²€ν† 
   - μ΄κ³Ό/μ™Έλ¶€ β†’ λ§¤λ„ κ²€ν† 
7. μ•λ¦Ό λ°μ†΅
```

### μ‘μ—… ν•­λ©
- [ ] `scripts/nas/daily_recommendation_alert.py` μ‹ κ· μƒμ„±
- [ ] `core/strategy/signal_generator.py` μ‹ κ· μƒμ„± (μ‹ νΈ μƒμ„± λ΅μ§)
- [ ] ν¬λ΅  λ“±λ΅ (μ: 08:30 μ¥μ‹μ‘ μ „)

---

## 4. κΈ°μ΅΄ μ•λ¦Όμ— Live νλΌλ―Έν„° μ—°λ™

### μ•λ¦Όλ³„ μ—°λ™ λ²”μ„

| μ•λ¦Ό | μ—°λ™ μμ¤€ | λ³€κ²½ λ‚΄μ© |
|------|-----------|-----------|
| **μ¥μ‹μ‘ μ•λ¦Ό** | μ”μ•½λ§ | ν•λ‹¨μ— ν• μ¤„ μ¶”κ°€: `π”§ ν„μ¬ μ „λµ: λ£©λ°± 3M / MA 40 / RSI 9 / μ†μ  -20%` |
| **μΌμΌ λ¦¬ν¬νΈ** | κ°•ν•κ² | λ§¤λ§¤ μ‹ νΈ μ„Ήμ…μ— Live κΈ°λ° μ‹ νΈ / ν¬μ μ „λµ μ„Ήμ…μ— νλΌλ―Έν„° μ”μ•½ |
| **μ£Όκ°„ λ¦¬ν¬νΈ** | μ¤‘κ°„ | μ†μ  λ¦¬μ¤νΈμ— ν•©μ„± μ†μ  / λ‹¤μ μ£Ό μ „λµμ— νλΌλ―Έν„° μ”μ•½ |
| **μ¥μ¤‘ μ•λ¦Ό** | μ•½ν•κ² | (μ„ νƒ) ETF μ λ‹λ²„μ¤ ν•„ν„° μµμ… |

### μ‘μ—… ν•­λ©
- [ ] `market_open_alert.py`: Live νλΌλ―Έν„° μ”μ•½ ν• μ¤„ μ¶”κ°€
- [ ] `daily_report_alert.py`: λ§¤λ§¤ μ‹ νΈ + ν¬μ μ „λµ μ„Ήμ… μμ •
- [ ] `weekly_report_alert.py`: μ†μ  λ¦¬μ¤νΈ + λ‹¤μ μ£Ό μ „λµ μμ •
- [ ] `intraday_alert.py`: (μ„ νƒ) μ λ‹λ²„μ¤ ν•„ν„° μµμ…

---

## 5. μ†μ  ν•©μ„± λ΅μ§

### λ©ν‘
ETFμ™€ κ°λ³„μ£Όμ μ†μ  κΈ°μ¤€ λ¶„λ¦¬

### λ΅μ§
```python
def get_stop_loss(ticker, live_params, hybrid_matrix):
    if is_etf(ticker):
        # ETF: μ „λµ μ†μ κ³Ό ν•μ΄λΈλ¦¬λ“ μ¤‘ λ” λ³΄μμ μΈ κ°’
        strategy_stop = live_params["stop_loss"]  # μ: -20%
        hybrid_stop = hybrid_matrix.get_stop(ticker)  # μ: -10%
        return max(strategy_stop, hybrid_stop)  # -10% (λ” λ³΄μμ )
    else:
        # κ°λ³„μ£Ό: ν•μ΄λΈλ¦¬λ“λ§ μ‚¬μ©
        return hybrid_matrix.get_stop(ticker)
```

### μ‘μ—… ν•­λ©
- [ ] `core/strategy/stop_loss_manager.py` μ‹ κ· μƒμ„±
- [ ] μ£Όκ°„ λ¦¬ν¬νΈ μ†μ  λ¦¬μ¤νΈμ— μ μ©
- [ ] μ†μ  λ¨λ‹ν„°λ§ μ•λ¦Όμ— μ μ©

---

## 6. lookback νλΌλ―Έν„° μ¶”κ°€

### λ©ν‘
νλ‹ μ‹ μ‚¬μ©ν• λ£©λ°± κΈ°κ°„μ„ Live νλΌλ―Έν„°μ— ν¬ν•¨

### λ³€κ²½
```json
"live": {
  "params": {
    "lookback": "3M",  // μ¶”κ°€
    "ma_period": 40,
    "rsi_period": 9,
    "stop_loss": -20
  }
}
```

### μ‘μ—… ν•­λ©
- [ ] `TuningParams`μ— `lookback_months` μ΄λ―Έ μμ β†’ μ €μ¥ μ‹ ν¬ν•¨
- [ ] `OptimalParamsService.promote_to_live()`μ—μ„ lookback μ €μ¥
- [ ] μ•λ¦Όμ—μ„ lookback ν‘μ‹

---

# κΈ°κµ¬ν„ ν„ν™© (μ°Έκ³ μ©)

## β… μ™„λ£λ ν•­λ©

### μ‹μ¤ν… μ „λ°
- λ°μ΄ν„° μμ§‘ (pykrx)
- λ°μ΄ν„° μΊμ‹± (Parquet)
- μ λ‹λ²„μ¤ ν•„ν„°λ§
- μΊλ¦°λ” κ°€λ“ (ν΄μ¥μΌ)
- λ΅κΉ… μ‹μ¤ν…

### μ „λµ
- λ μ§ μ •μ (MA50/200)
- λ¨λ©ν…€ μ¤μ½”μ–΄ (MAPS)
- RSI λΉ„μ¤‘ μ¤μΌ€μΌλ§
- λ°±ν…μ¤νΈ μ—”μ§„/λ¬λ„
- μ¤νƒ‘λ΅μ¤
- λ°©μ–΄ μ‹μ¤ν…

### νλ‹
- Optuna νλ‹
- Train/Val/Test λ¶„ν• 
- κ³Όμ ν•© κ²½κ³ 
- μ—”μ§„ ν—¬μ¤μ²΄ν¬
- pick_best_trial μ•κ³ λ¦¬μ¦

### API/UI
- λ°±ν…μ¤νΈ API
- νλ‹ UI
- AI λ¶„μ„ ν”„λ΅¬ν”„νΈ μƒμ„±

### μ•λ¦Ό
- μ¥μ‹μ‘ μ•λ¦Ό
- μ¥μ¤‘ μ•λ¦Ό
- μΌμΌ λ¦¬ν¬νΈ
- μ£Όκ°„ λ¦¬ν¬νΈ
- ν…”λ κ·Έλ¨/Slack

---

# νλΌλ―Έν„° μƒμ• μ£ΌκΈ°

```
[νλ‹ Trial] β†’ Research (μ—°κµ¬ κ²°κ³Ό)
     β†“
[AI λ¶„μ„ + μ‚¬λ νλ‹¨] β†’ "μ΄κ±° κ΄μ°®λ‹¤"
     β†“
[μ‹¤μ „ νλΌλ―Έν„°λ΅ μ μ©] β†’ Live (μ΄μ νλΌλ―Έν„°)
     β†“
[PUSH μ¤ν¬λ¦½νΈ] β†’ μ¤μ§ Liveλ§ μ‚¬μ©
```

## μ„ λ³„ μ΅°κ±΄ (pick_best_trial)

```python
def pick_best_trial(trials):
    valid = [
        t for t in trials
        if t["engine_health"]["is_valid"]      # 1. μ—”μ§„ μ •μƒ
        and t["status"] == "μ •μƒ"               # 2. μƒνƒ μ •μƒ
        and t["test"]["sharpe"] > 0            # 3. Test Sharpe μ–‘μ
        and t["test"]["sharpe"] >= t["train"]["sharpe"] * 0.7  # 4. κ³Όμ ν•© ν•„ν„°
    ]
    return max(valid, key=lambda t: t["test"]["sharpe"])
```

---

# μ•λ¦Όλ³„ νλΌλ―Έν„° μ‚¬μ© μ”μ•½

| μ•λ¦Ό | νλΌλ―Έν„° μ‚¬μ© | μ—°λ™ μμ¤€ |
|------|---------------|-----------|
| **μΌμΌ μ¶”μ²** | lookback, ma_period, rsi_period, stop_loss | π”΄ κ°•ν•κ² |
| **μΌμΌ λ¦¬ν¬νΈ (λ§¤λ§¤ μ‹ νΈ)** | lookback, ma_period, rsi_period | π”΄ κ°•ν•κ² |
| **μΌμΌ λ¦¬ν¬νΈ (ν¬μ μ „λµ)** | μ „μ²΄ μ”μ•½ | π”΄ κ°•ν•κ² |
| **μ£Όκ°„ λ¦¬ν¬νΈ (λ‹¤μ μ£Ό μ „λµ)** | μ „μ²΄ μ”μ•½ | π΅ μ¤‘κ°„ |
| **μ£Όκ°„ λ¦¬ν¬νΈ (μ†μ  λ¦¬μ¤νΈ)** | stop_loss + ν•μ΄λΈλ¦¬λ“ ν•©μ„± | π΅ μ¤‘κ°„ |
| **μ†μ  λ¨λ‹ν„°λ§** | stop_loss + ν•μ΄λΈλ¦¬λ“ ν•©μ„± | π΅ μ¤‘κ°„ |
| **μ¥μ‹μ‘ μ•λ¦Ό** | μ”μ•½ ν• μ¤„ | πΆ μ•½ν•κ² |
| **μ¥μ¤‘ μ•λ¦Ό** | (μ„ νƒ) μ λ‹λ²„μ¤ ν•„ν„° | πΆ μ•½ν•κ² |
