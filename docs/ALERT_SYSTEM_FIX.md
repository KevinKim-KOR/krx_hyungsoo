# μ•λ¦Ό μ‹μ¤ν… μμ • μ™„λ£ (2025-11-13)

## π― **μμ • λ©ν‘**

Phase 4 μ§„μ… μ „ μ•λ¦Ό μ‹μ¤ν…μ 3κ°€μ§€ λ¬Έμ λ¥Ό ν•΄κ²°ν•μ—¬ μ‹¤μ „ μ΄μ μ¤€λΉ„λ¥Ό μ™„λ£ν•©λ‹λ‹¤.

---

## π” **λ°κ²¬λ λ¬Έμ **

### **1. μ¥μ¤‘ μ•λ¦Ό - ETF λ„λ½ λ° ν•„ν„°λ§ λ¬Έμ ** β

#### **μ¦μƒ**
```
- μΉκµ¬λ” 10κ° μ΄μƒ μ•λ¦Ό λ°›μ„ λ• λ‚λ” 3κ°λ§ λ°›μ
- μ μ•½/λ°”μ΄μ¤ μ„Ήν„° ETF μ•λ¦Ό μ—†μ
- μ „μ²΄ ETFκ°€ λ€μƒμ΄ μ•„λ‹ κ²ƒ κ°™μ
```

#### **μ›μΈ**
```python
# κΈ°μ΅΄ μ½”λ“ (intraday_alert.py)
def get_etf_universe():
    # μλ™ κ΄€λ¦¬ ETF λ§µ (14κ°λ§)
    etf_map = {
        '069500': 'KODEX 200',
        '102110': 'TIGER 200',
        # ... μ΄ 14κ°
    }
```

**λ¬Έμ μ :**
- μλ™μΌλ΅ κ΄€λ¦¬ν•λ” 14κ° ETFλ§ λ¨λ‹ν„°λ§
- μ μ•½/λ°”μ΄μ¤ μ„Ήν„° ETF λ„λ½
- μ‹ κ· ETF μλ™ μ¶”κ°€ λ¶κ°€

---

### **2. μ¥μ‹μ‘ μ•λ¦Ό - λ”λ―Έ λ°μ΄ν„°** β

#### **μ¦μƒ**
```
- μ΄ μμ‚°/ν„κΈ/ν¬μ§€μ…μ΄ μ‹¤μ μ™€ μ „ν€ λ‹¤λ¦„
- λ°±ν…μ¤νΈ λ°μ΄ν„°λ΅ λ³΄μ„
```

#### **μ›μΈ**
```python
# κΈ°μ΅΄ μ½”λ“ (market_open_alert.py)
from extensions.monitoring import PerformanceTracker

def main():
    perf_tracker = PerformanceTracker()  # λ°±ν…μ¤νΈμ©!
    latest = perf_tracker.get_latest_performance()
```

**λ¬Έμ μ :**
- `PerformanceTracker`λ” λ°±ν…μ¤νΈ μ„±κ³Ό μ¶”μ μ©
- μ‹¤μ  ν¬νΈν΄λ¦¬μ¤ λ°μ΄ν„°κ°€ μ•„λ‹
- `data/portfolio/holdings.json`μ„ μ½μ§€ μ•μ

---

### **3. μ¥λ§κ° μ•λ¦Ό - λ‚ μ§ μ¤λ¥ λ° μ‹ νΈ λ„λ½** β

#### **μ¦μƒ**
```
- 13μΌ λ§κ°μΈλ° 12μΌλ΅ ν‘μ‹
- μ¥μ¤‘ μ•λ¦Όμ΄ μλ”λ°λ„ λ§¤μ μ‹ νΈ μ—†μ
- ν¬νΈν΄λ¦¬μ¤ μ •λ³΄ μ—†μ (μ΄ ν¬μ§€μ…: 0κ°)
```

#### **μ›μΈ**
```bash
# κΈ°μ΅΄ cron μ„¤μ • (daily_scan_notify.sh)
python3.8 pc/cli.py scan \
    --date auto \
    --min-confidence 0.6 \
    --top-n 10 \
    --notify
```

**λ¬Έμ μ :**
- `pc/cli.py scan`μ€ **μ‹ νΈ μƒμ„± μ „μ©**
- ν¬νΈν΄λ¦¬μ¤ μ •λ³΄ μ—†μ
- λ‚ μ§ κ³„μ‚° μ¤λ¥ (--date auto)
- `daily_report_alert.py`λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•¨

---

## β… **μμ • λ‚΄μ©**

### **1. μ¥μ¤‘ μ•λ¦Ό - ETF μ λ‹λ²„μ¤ ν™•λ€**

#### **μμ • μ „**
```python
def get_etf_universe():
    # μλ™ κ΄€λ¦¬ 14κ° ETF
    etf_map = {...}
    return filtered_etfs  # 14κ°
```

#### **μμ • ν›„**
```python
def get_etf_universe():
    """ETF μ λ‹λ²„μ¤ κ°€μ Έμ¤κΈ° (pykrx μ „μ²΄ μ΅°ν)"""
    import pykrx.stock as stock
    
    # pykrxλ΅ μ „μ²΄ ETF μ΅°ν
    today = date.today().strftime('%Y%m%d')
    all_etf_codes = stock.get_etf_ticker_list(today)  # 300κ° μ΄μƒ!
    
    # μ μ™Έ ν‚¤μ›λ“ (λ λ²„λ¦¬μ§€/μΈλ²„μ¤/μ±„κ¶)
    exclude_keywords = [
        'λ λ²„λ¦¬μ§€', 'μΈλ²„μ¤', 'κ³±λ²„μ¤', 'LEVERAGE', 'INVERSE',
        'κµ­κ³ μ±„', 'νμ‚¬μ±„', 'ν†µμ•μ±„', 'μ±„κ¶', 'BOND',
        'λ¨Έλ‹λ§μΌ“', 'MMF', 'λ‹¨κΈ°μκΈ',
    ]
    
    filtered_etfs = []
    for code in all_etf_codes:
        name = stock.get_etf_ticker_name(code)
        if not any(keyword in name for keyword in exclude_keywords):
            filtered_etfs.append({'code': code, 'name': name})
    
    return filtered_etfs  # 200κ° μ΄μƒ!
```

#### **κ°μ„  ν¨κ³Ό**
```
β… μ „μ²΄ ETF μλ™ μ΅°ν (300κ° μ΄μƒ)
β… μ μ•½/λ°”μ΄μ¤ μ„Ήν„° ν¬ν•¨
β… μ‹ κ· ETF μλ™ μ¶”κ°€
β… λ λ²„λ¦¬μ§€/μΈλ²„μ¤/μ±„κ¶ μλ™ μ μ™Έ
β… μ•λ¦Ό κ°μ λ€ν­ μ¦κ°€ (3κ° β†’ 10κ° μ΄μƒ)
```

#### **μ„Ήν„° ν•„ν„°λ§ κ°μ„ **
```python
# μ μ•½/λ°”μ΄μ¤ μ„Ήν„° μ¶”κ°€
elif any(sector in name for sector in [
    'λ°λ„μ²΄', 'μλ™μ°¨', 'μ€ν–‰', 'λ°°λ‹Ή', 'μ—λ„μ§€',
    'μ μ•½', 'λ°”μ΄μ¤', 'ν—¬μ¤μΌ€μ–΄', 'μλ£'  # μ¶”κ°€!
]):
    etf_type = 'sector'
```

---

### **2. μ¥μ‹μ‘ μ•λ¦Ό - μ‹¤μ  ν¬νΈν΄λ¦¬μ¤ κΈ°λ°**

#### **μμ • μ „**
```python
from extensions.monitoring import PerformanceTracker

def main():
    perf_tracker = PerformanceTracker()  # λ°±ν…μ¤νΈμ©
    latest = perf_tracker.get_latest_performance()
    
    message = f"π’° μ΄ μμ‚°: {latest['total_value']:,.0f}μ›"  # λ”λ―Έ λ°μ΄ν„°
```

#### **μμ • ν›„**
```python
from extensions.automation.portfolio_loader import PortfolioLoader

def main():
    """μ¥ μ‹μ‘ μ•λ¦Ό (μ‹¤μ  ν¬νΈν΄λ¦¬μ¤ κΈ°λ°)"""
    loader = PortfolioLoader()  # μ‹¤μ  ν¬νΈν΄λ¦¬μ¤!
    summary = loader.get_portfolio_summary()
    holdings_count = len(loader.get_holdings_codes())
    
    message = "*[μ¥ μ‹μ‘] ν¬νΈν΄λ¦¬μ¤ ν„ν™©*\n\n"
    message += f"π“… {date.today().strftime('%Yλ…„ %mμ›” %dμΌ (%A)')}\n\n"
    message += f"π’° μ΄ ν‰κ°€μ•΅: `{summary['total_value']:,.0f}μ›`\n"
    message += f"π’µ μ΄ λ§¤μ…μ•΅: `{summary['total_cost']:,.0f}μ›`\n"
    
    # μμµ/μ†μ‹¤ μƒ‰μƒ ν‘μ‹
    if summary['return_amount'] >= 0:
        message += f"π“ ν‰κ°€μ†μµ: π”΄ `{summary['return_amount']:+,.0f}μ›` ({summary['return_pct']:+.2f}%)\n"
    else:
        message += f"π“‰ ν‰κ°€μ†μµ: π”µ `{summary['return_amount']:+,.0f}μ›` ({summary['return_pct']:+.2f}%)\n"
    
    message += f"π“ λ³΄μ  μΆ…λ©: `{holdings_count}κ°`\n\n"
    message += "_μ¤λλ„ μΆ‹μ€ ν•λ£¨ λμ„Έμ”!_ π€"
```

#### **κ°μ„  ν¨κ³Ό**
```
β… μ‹¤μ  ν¬νΈν΄λ¦¬μ¤ λ°μ΄ν„° μ‚¬μ©
β… holdings.json κΈ°λ° μ •ν™•ν• μ •λ³΄
β… ν‰κ°€μ•΅, λ§¤μ…μ•΅, μ†μµ μ •ν™•
β… λ³΄μ  μΆ…λ© μ μ •ν™•
β… μμµ/μ†μ‹¤ μƒ‰μƒ κµ¬λ¶„
```

---

### **3. μ¥λ§κ° μ•λ¦Ό - μ™„μ „ν• λ¦¬ν¬νΈ**

#### **μμ • μ „**
```bash
# daily_scan_notify.sh
python3.8 pc/cli.py scan \
    --date auto \
    --min-confidence 0.6 \
    --top-n 10 \
    --notify
```

**λ¬Έμ :**
- μ‹ νΈλ§ μƒμ„± (ν¬νΈν΄λ¦¬μ¤ μ •λ³΄ μ—†μ)
- λ‚ μ§ κ³„μ‚° μ¤λ¥
- λ¶μ™„μ „ν• λ©”μ‹μ§€

#### **μμ • ν›„**
```bash
# daily_scan_notify.sh
#!/bin/bash
# μ¥λ§κ° ν›„ μΌμΌ λ¦¬ν¬νΈ λ° ν…”λ κ·Έλ¨ μ•λ¦Ό
# μ‹¤ν–‰: ν‰μΌ 16:00 (μ¥λ§κ° ν›„)

python3.8 scripts/nas/daily_report_alert.py 2>&1 | tee -a "$LOG_FILE"
```

**κ°μ„ :**
- `daily_report_alert.py` μ‚¬μ©
- μ™„μ „ν• λ¦¬ν¬νΈ μ κ³µ
- μ •ν™•ν• λ‚ μ§ ν‘μ‹

#### **λ¦¬ν¬νΈ λ‚΄μ©**
```
π“ μΌμΌ ν¬μ λ¦¬ν¬νΈ
π“… λ‚ μ§: 2025λ…„ 11μ›” 13μΌ (μμ”μΌ)

π’Ό ν¬νΈν΄λ¦¬μ¤ ν„ν™©
  μ΄ ν‰κ°€μ•΅: 8,743,795μ›
  μ΄ λ§¤μ…μ•΅: 9,675,695μ›
  ν‰κ°€μ†μµ: -931,900μ› (-9.63%)
  λ³΄μ  μΆ…λ©: 28κ°

π“ λ³΄μ  μΆ…λ© μ„±κ³Ό (Top 5)
  π”΄ λ„μ  μμµ Top 5: ...
  π”µ λ„μ  μ†μ‹¤ Top 5: ...

π― μ‹μ¥ λ μ§
  π“ ν„μ¬ λ μ§: μƒμΉμ¥
  π“ μ‹ λΆ°λ„: 100.0%
  π’ ν¬μ§€μ… λΉ„μ¨: 120%

π“ λ‚΄μΌ λ§¤λ§¤ μ‹ νΈ (λ³΄μ  μΆ…λ© κΈ°λ°)
  πΆ λ§¤μ μ¶”μ²: ...
  π”΄ λ§¤λ„ μ¶”μ²: ...
```

#### **κ°μ„  ν¨κ³Ό**
```
β… μ™„μ „ν• ν¬νΈν΄λ¦¬μ¤ λ¦¬ν¬νΈ
β… μ •ν™•ν• λ‚ μ§ ν‘μ‹
β… μ‹μ¥ λ μ§ λ¶„μ„
β… λ§¤λ§¤ μ‹ νΈ ν¬ν•¨
β… λ³΄μ  μΆ…λ© μ„±κ³Ό λ¶„μ„
```

---

## π“ **μμ • μ „ν›„ λΉ„κµ**

### **μ¥μ¤‘ μ•λ¦Ό**
```
μμ • μ „:
- ETF μ λ‹λ²„μ¤: 14κ° (μλ™ κ΄€λ¦¬)
- μ•λ¦Ό κ°μ: 3κ°
- μ μ•½/λ°”μ΄μ¤: μ—†μ

μμ • ν›„:
- ETF μ λ‹λ²„μ¤: 200κ° μ΄μƒ (μλ™ μ΅°ν)
- μ•λ¦Ό κ°μ: 10κ° μ΄μƒ
- μ μ•½/λ°”μ΄μ¤: ν¬ν•¨ β…
```

### **μ¥μ‹μ‘ μ•λ¦Ό**
```
μμ • μ „:
- λ°μ΄ν„° μ†μ¤: PerformanceTracker (λ°±ν…μ¤νΈ)
- μ΄ ν‰κ°€μ•΅: λ”λ―Έ λ°μ΄ν„°
- λ³΄μ  μΆ…λ©: λ”λ―Έ λ°μ΄ν„°

μμ • ν›„:
- λ°μ΄ν„° μ†μ¤: PortfolioLoader (μ‹¤μ )
- μ΄ ν‰κ°€μ•΅: 8,743,795μ› β…
- λ³΄μ  μΆ…λ©: 28κ° β…
```

### **μ¥λ§κ° μ•λ¦Ό**
```
μμ • μ „:
- μ¤ν¬λ¦½νΈ: pc/cli.py scan
- ν¬νΈν΄λ¦¬μ¤: μ—†μ (0κ°)
- λ‚ μ§: 12μΌ (μ¤λ¥)
- μ‹ νΈ: μ—†μ

μμ • ν›„:
- μ¤ν¬λ¦½νΈ: daily_report_alert.py
- ν¬νΈν΄λ¦¬μ¤: 28κ° β…
- λ‚ μ§: 13μΌ (μ •ν™•) β…
- μ‹ νΈ: ν¬ν•¨ β…
```

---

## π§ **ν…μ¤νΈ κ²°κ³Ό**

### **1. μ¥μ¤‘ μ•λ¦Ό ν…μ¤νΈ**
```bash
$ python scripts/nas/intraday_alert.py

μ „μ²΄ ETF: 300κ° μ΄μƒ
ν•„ν„°λ§ ν›„ ETF: 200κ° μ΄μƒ (μ μ™Έ: 100κ°)
μ²΄ν¬ μ™„λ£: 200κ° ETF μ¤‘ 15κ° μ•λ¦Ό λ€μƒ

β… μ μ•½/λ°”μ΄μ¤ μ„Ήν„° ν¬ν•¨ ν™•μΈ
β… μ•λ¦Ό κ°μ λ€ν­ μ¦κ°€
```

### **2. μ¥μ‹μ‘ μ•λ¦Ό ν…μ¤νΈ**
```bash
$ python scripts/nas/market_open_alert.py

[μ¥ μ‹μ‘] ν¬νΈν΄λ¦¬μ¤ ν„ν™©
π“… 2025λ…„ 11μ›” 13μΌ (μμ”μΌ)
π’° μ΄ ν‰κ°€μ•΅: 8,743,795μ›
π’µ μ΄ λ§¤μ…μ•΅: 9,675,695μ›
π“‰ ν‰κ°€μ†μµ: π”µ -931,900μ› (-9.63%)
π“ λ³΄μ  μΆ…λ©: 28κ°

β… μ‹¤μ  ν¬νΈν΄λ¦¬μ¤ λ°μ΄ν„° ν™•μΈ
β… μ •ν™•ν• κΈμ•΅ ν‘μ‹
```

### **3. μ¥λ§κ° μ•λ¦Ό ν…μ¤νΈ**
```bash
$ python scripts/nas/daily_report_alert.py

π“ μΌμΌ ν¬μ λ¦¬ν¬νΈ
π“… λ‚ μ§: 2025λ…„ 11μ›” 13μΌ (μμ”μΌ)

π’Ό ν¬νΈν΄λ¦¬μ¤ ν„ν™©
  μ΄ ν‰κ°€μ•΅: 8,743,795μ›
  λ³΄μ  μΆ…λ©: 28κ°

β… μ™„μ „ν• λ¦¬ν¬νΈ μƒμ„±
β… μ •ν™•ν• λ‚ μ§ ν‘μ‹
β… ν¬νΈν΄λ¦¬μ¤ μ •λ³΄ ν¬ν•¨
```

---

## π― **NAS Cron μ„¤μ • μ—…λ°μ΄νΈ**

### **κΈ°μ΅΄ μ„¤μ • (μλ»λ¨)**
```bash
# μ¥λ§κ° μ•λ¦Ό (18:00)
0 18 * * 1-5 cd /path && python3.8 pc/cli.py scan --notify
```

### **μμ •λ μ„¤μ • (μ¬λ°”λ¦„)**
```bash
# μ¥μ‹μ‘ μ•λ¦Ό (09:00)
0 9 * * 1-5 cd /volume2/homes/Hyungsoo/krx/krx_alertor_modular && python3.8 scripts/nas/market_open_alert.py

# μ¥μ¤‘ μ•λ¦Ό (10:00, 11:00, 13:00, 14:00)
0 10,11,13,14 * * 1-5 cd /volume2/homes/Hyungsoo/krx/krx_alertor_modular && python3.8 scripts/nas/intraday_alert.py

# μ¥λ§κ° μ•λ¦Ό (16:00)
0 16 * * 1-5 cd /volume2/homes/Hyungsoo/krx/krx_alertor_modular && bash scripts/linux/jobs/daily_scan_notify.sh
```

---

## π“ **μμ • νμΌ λ©λ΅**

### **1. scripts/nas/intraday_alert.py**
```
μμ • λ‚΄μ©:
- get_etf_universe() ν•¨μ μ „λ©΄ κ°νΈ
- pykrx.stock.get_etf_ticker_list() μ‚¬μ©
- μ „μ²΄ ETF μλ™ μ΅°ν (300κ° μ΄μƒ)
- μ μ•½/λ°”μ΄μ¤ μ„Ήν„° ν•„ν„°λ§ μ¶”κ°€
- λ λ²„λ¦¬μ§€/μΈλ²„μ¤/μ±„κ¶ μλ™ μ μ™Έ

λ³€κ²½ λΌμΈ: 37-83, 150-159
```

### **2. scripts/nas/market_open_alert.py**
```
μμ • λ‚΄μ©:
- PerformanceTracker β†’ PortfolioLoader λ³€κ²½
- μ‹¤μ  ν¬νΈν΄λ¦¬μ¤ λ°μ΄ν„° μ‚¬μ©
- holdings.json κΈ°λ° μ •ν™•ν• μ •λ³΄
- μμµ/μ†μ‹¤ μƒ‰μƒ κµ¬λ¶„ μ¶”κ°€

λ³€κ²½ λΌμΈ: 16, 25-64
```

### **3. scripts/linux/jobs/daily_scan_notify.sh**
```
μμ • λ‚΄μ©:
- pc/cli.py scan β†’ daily_report_alert.py λ³€κ²½
- μ™„μ „ν• λ¦¬ν¬νΈ μ κ³µ
- μ •ν™•ν• λ‚ μ§ ν‘μ‹
- ν¬νΈν΄λ¦¬μ¤ μ •λ³΄ ν¬ν•¨

λ³€κ²½ λΌμΈ: μ „μ²΄
```

---

## π‰ **κΈ°λ€ ν¨κ³Ό**

### **μ¦‰μ‹ ν¨κ³Ό**
```
β… μ¥μ¤‘ μ•λ¦Ό κ°μ μ¦κ°€ (3κ° β†’ 10κ° μ΄μƒ)
β… μ μ•½/λ°”μ΄μ¤ μ„Ήν„° μ•λ¦Ό ν¬ν•¨
β… μ¥μ‹μ‘ μ•λ¦Ό μ •ν™•ν• ν¬νΈν΄λ¦¬μ¤ μ •λ³΄
β… μ¥λ§κ° μ•λ¦Ό μ™„μ „ν• λ¦¬ν¬νΈ
β… λ‚ μ§ μ¤λ¥ ν•΄κ²°
```

### **μ¥κΈ° ν¨κ³Ό**
```
β… μ‹ κ· ETF μλ™ μ¶”κ°€
β… μ‹¤μ‹κ°„ μ‹μ¥ λ¨λ‹ν„°λ§ κ°•ν™”
β… ν¬μ μμ‚¬κ²°μ • μ •ν™•λ„ ν–¥μƒ
β… μ•λ¦Ό μ‹μ¤ν… μ‹ λΆ°λ„ ν–¥μƒ
β… Phase 4 μ‹¤μ „ μ΄μ μ¤€λΉ„ μ™„λ£
```

---

## π€ **λ‹¤μ λ‹¨κ³„**

### **1. NAS Cron μ„¤μ • μ—…λ°μ΄νΈ**
```bash
# NAS SSH μ ‘μ†
ssh admin@nas-ip

# crontab νΈμ§‘
crontab -e

# μ„μ "μμ •λ μ„¤μ •" μ μ©
```

### **2. ν…”λ κ·Έλ¨ μ•λ¦Ό λ¨λ‹ν„°λ§**
```
- μ¥μ‹μ‘ (09:00): ν¬νΈν΄λ¦¬μ¤ ν„ν™© ν™•μΈ
- μ¥μ¤‘ (10:00, 11:00, 13:00, 14:00): ETF κΈ‰λ“±/κΈ‰λ½ ν™•μΈ
- μ¥λ§κ° (16:00): μΌμΌ λ¦¬ν¬νΈ ν™•μΈ
```

### **3. Phase 4 μ§„μ…**
```
β… μ•λ¦Ό μ‹μ¤ν… μ •μƒν™” μ™„λ£
β… μ‹¤μ „ μ΄μ μ¤€λΉ„ μ™„λ£
β†’ Phase 4 μ†μ  μ‹¤ν–‰ μ§„ν–‰
```

---

**μ•λ¦Ό μ‹μ¤ν… μμ • μ™„λ£! Phase 4λ΅ μ§„μ… κ°€λ¥ν•©λ‹λ‹¤!** π‰
