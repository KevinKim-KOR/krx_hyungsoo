# 하이브리드 전략 구현 계획 (Option A)

**작성일**: 2025-11-07  
**목표**: Jason 공격 로직 + 방어 시스템 + 자동화  
**기간**: 3~4주  
**예상 성과**: 연평균 +10~12%, Sharpe 1.5~2.0

---

## 📋 전체 개요

### 핵심 전략
```
Jason의 공격적 모멘텀 (상승장)
        +
우리의 방어적 리스크 관리 (하락장)
        +
자동화된 모니터링 (시간 제약)
        =
All-Weather 하이브리드 전략
```

### 설계 원칙
1. **시장 상황별 대응**: 상승장(공격) / 하락장(방어) / 중립장(하이브리드)
2. **자동 손절**: 개별 -7%, 포트폴리오 -15%
3. **시간 최소화**: 평일 5분, 주말 30분
4. **단계적 통합**: 주차별 독립 모듈, 롤백 가능

---

## 🎯 주차별 실행 계획

### Week 1: 백테스트 인프라 통합 ⭐⭐⭐
**목표**: Jason 백테스트 엔진으로 정확한 성과 측정

#### 작업 항목
- [ ] Jason 코드 분석 (2시간)
  - `backtest/engine.py` 구조 파악
  - `portfolio.py` 포지션 관리 로직
  - `metrics.py` 성과 지표 계산
  
- [ ] 어댑터 패턴 구현 (4시간)
  - `core/engine/jason_adapter.py` 생성
  - 데이터 형식 변환 (우리 → Jason)
  - 결과 형식 변환 (Jason → 우리)
  
- [ ] 통합 테스트 (2시간)
  - 단순 데이터로 검증
  - 성과 지표 비교
  - 롤백 테스트

#### 성공 기준
- ✅ Jason 엔진으로 백테스트 실행 성공
- ✅ 정확한 Sharpe Ratio, MDD 계산
- ✅ 기존 시스템 영향 없음

#### 예상 시간
- **총 8시간** (평일 저녁 2시간 × 4일)

---

### Week 2: 방어 시스템 구현 ⭐⭐⭐
**목표**: 하락장 손실 최소화 (-30~50% 감소)

#### 작업 항목
- [ ] 자동 손절 시스템 (4시간)
  - `core/strategy/defense_system.py` 생성
  - 개별 종목 손절 (-7%)
  - 포트폴리오 손절 (-15%)
  - 트레일링 스톱 구현
  
- [ ] 시장 급락 감지 (3시간)
  - KOSPI 급락 감지 (5일 -10%)
  - 보유 종목 동반 하락 감지 (80% 이상)
  - VIX 지수 연동 (선택)
  
- [ ] 변동성 관리 (2시간)
  - 변동성 기반 포지션 크기 조절
  - 섹터 분산 체크
  - 현금 버퍼 관리 (20%)

#### 성공 기준
- ✅ 손절 로직 정상 작동
- ✅ 백테스트에서 MDD 감소 확인
- ✅ 알림 시스템 연동

#### 예상 시간
- **총 9시간** (평일 저녁 2시간 × 4일 + 주말 1시간)

---

### Week 3: 하이브리드 전략 구현 ⭐⭐
**목표**: 상승장 수익 극대화 (+20~30%)

#### 작업 항목
- [ ] Jason 모멘텀 로직 분석 (3시간)
  - 상대 강도 계산 방식
  - Top N 선택 알고리즘
  - 포지션 크기 결정 로직
  
- [ ] 시장 상태 감지기 (3시간)
  - `core/strategy/market_regime.py` 생성
  - 상승장/하락장/중립장 판단
  - 이동평균, 모멘텀 기반
  
- [ ] 하이브리드 전략 통합 (6시간)
  - `core/strategy/hybrid_strategy.py` 생성
  - 상승장: Jason 로직 + 리스크 필터
  - 하락장: 방어 모드
  - 중립장: 하이브리드

#### 성공 기준
- ✅ 시장 상태별 전략 전환 작동
- ✅ 백테스트 수익률 개선 확인
- ✅ 변동성 관리 유지

#### 예상 시간
- **총 12시간** (평일 저녁 2시간 × 4일 + 주말 4시간)

---

### Week 4: 자동화 시스템 구현 ⭐
**목표**: 모니터링 시간 90% 감소

#### 작업 항목
- [ ] 자동 모니터링 (4시간)
  - `extensions/automation/auto_monitor.py` 생성
  - 일일 체크 (장 마감 후)
  - 손절 필요 종목 자동 감지
  - 리밸런싱 알림 (주말)
  
- [ ] 알림 시스템 강화 (2시간)
  - 텔레그램 우선순위 알림
  - 긴급 알림 (손절, 시장 급락)
  - 일반 알림 (리밸런싱, 기회)
  
- [ ] 리포트 자동화 (2시간)
  - 일일 요약 리포트
  - 주간 성과 리포트
  - 월간 분석 리포트

#### 성공 기준
- ✅ 자동 체크 정상 작동
- ✅ 알림 수신 확인
- ✅ 리포트 생성 확인

#### 예상 시간
- **총 8시간** (평일 저녁 2시간 × 3일 + 주말 2시간)

---

## 📁 파일 구조

```
krx_alertor_modular/
├── core/
│   ├── engine/
│   │   ├── backtest.py              # 기존 (유지)
│   │   ├── jason_adapter.py         # 신규 (Week 1)
│   │   └── jason_engine.py          # 신규 (Week 1, Jason 코드)
│   ├── strategy/
│   │   ├── signal_generator.py      # 기존 (유지)
│   │   ├── defense_system.py        # 신규 (Week 2)
│   │   ├── market_regime.py         # 신규 (Week 3)
│   │   └── hybrid_strategy.py       # 신규 (Week 3)
│   └── metrics/
│       ├── performance.py           # 신규 (Week 1)
│       └── risk.py                  # 신규 (Week 1)
├── extensions/
│   └── automation/
│       ├── auto_monitor.py          # 신규 (Week 4)
│       └── alert_manager.py         # 신규 (Week 4)
├── scripts/
│   └── phase2/
│       ├── run_backtest.py          # 수정 (Week 1)
│       └── run_hybrid_backtest.py   # 신규 (Week 3)
└── tests/
    ├── test_jason_integration.py    # 신규 (Week 1)
    ├── test_defense_system.py       # 신규 (Week 2)
    └── test_hybrid_strategy.py      # 신규 (Week 3)
```

---

## 🎯 성과 목표

### 백테스트 목표 (2022-2025, 3.8년)
| 지표 | 현재 (MAPS) | Jason | 하이브리드 (목표) |
|------|-------------|-------|-------------------|
| 총 수익률 | +15% | +30% | **+40~50%** |
| CAGR | 3.7% | 7.5% | **10~12%** |
| Sharpe Ratio | 1.0 | 1.3 | **1.5~2.0** |
| Max Drawdown | -15% | -25% | **-10~12%** |
| Win Rate | 50% | 60% | **55~60%** |

### 운영 목표
- **모니터링 시간**: 주 1시간 이하
- **알림 응답**: 5분 이내 (긴급 시)
- **리밸런싱**: 주말 30분
- **안정성**: 자동 손절로 큰 손실 방지

---

## 🔄 Phase 2 재테스트 업데이트

### 기존 계획 (변경 전)
```
3단계: 기본 백테스트 (임시 결과)
4단계: Optuna 최적화
5단계: 워크포워드 분석
6단계: 로버스트니스 테스트
7단계: 결과 정리
```

### 새로운 계획 (Option A)
```
3단계: 기본 백테스트 (임시) ✅
├─ Week 1: Jason 엔진 통합 🔄
├─ Week 2: 방어 시스템
├─ Week 3: 하이브리드 전략
└─ Week 4: 자동화

3-1단계: 하이브리드 백테스트 (실제)
4단계: Optuna 최적화 (하이브리드)
5단계: 워크포워드 분석
6단계: 로버스트니스 테스트
7단계: 결과 정리
```

---

## 📊 진행 상황 추적

### Week 1 (현재)
- [x] 계획 수립
- [ ] Jason 코드 분석
- [ ] 어댑터 구현
- [ ] 통합 테스트

### Week 2
- [ ] 자동 손절 구현
- [ ] 시장 급락 감지
- [ ] 변동성 관리

### Week 3
- [ ] Jason 모멘텀 분석
- [ ] 시장 상태 감지기
- [ ] 하이브리드 통합

### Week 4
- [ ] 자동 모니터링
- [ ] 알림 시스템
- [ ] 리포트 자동화

---

## 🚨 리스크 관리

### 기술적 리스크
| 리스크 | 확률 | 영향 | 대응 |
|--------|------|------|------|
| Jason 코드 호환성 | 30% | 중 | 어댑터 패턴 |
| 성과 지표 오류 | 20% | 중 | 단위 테스트 |
| 전략 통합 복잡도 | 40% | 중 | 단계적 구현 |
| 자동화 오류 | 15% | 낮 | 수동 백업 |

### 일정 리스크
| 리스크 | 확률 | 대응 |
|--------|------|------|
| Week 1 지연 | 20% | Week 2로 이월 |
| Week 3 복잡도 | 30% | 간소화 버전 |
| 전체 지연 | 25% | Week 4 생략 가능 |

---

## 📝 다음 액션

### 즉시 실행 (오늘)
1. Jason 레포 클론
2. 핵심 파일 확인 (engine.py, portfolio.py)
3. 데이터 구조 분석

### 내일
1. 어댑터 패턴 설계
2. 인터페이스 정의
3. 기본 구현 시작

### 이번 주말
1. 통합 테스트
2. 성과 지표 검증
3. Week 1 완료

---

## 🎓 학습 자료

### Jason 코드 분석 포인트
- 백테스트 엔진 구조
- 포지션 관리 방식
- 리밸런싱 로직
- 성과 지표 계산

### 참고 문서
- `docs/PHASE2_RETEST_PLAN.md` (기존 계획)
- `best_params.json` (현재 파라미터)
- Jason 레포 README

---

## 📞 지원 및 문의

### 막힐 때
1. Jason 코드 주석 확인
2. 단위 테스트 작성
3. 로그 상세 분석
4. 롤백 후 재시도

### 성공 기준
- 각 주차별 체크리스트 완료
- 백테스트 결과 개선 확인
- 기존 시스템 정상 작동

---

**마지막 업데이트**: 2025-11-07 21:48  
**다음 리뷰**: Week 1 완료 시 (2025-11-14 예정)
