# AI Context Pack - KRX Alertor íŠœë‹ ì‹œìŠ¤í…œ

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-08  
**ë²„ì „**: 1.0  
**ìš©ë„**: AI í˜‘ì—… ì‹œ ì»¨í…ìŠ¤íŠ¸ ê³µìœ ìš©

---

## â‘  ëª©ì  (Purpose)

### í”„ë¡œì íŠ¸ ê°œìš”
ETF ëª¨ë©˜í…€ ì „ëžµì˜ **íŒŒë¼ë¯¸í„° ìµœì í™”(íŠœë‹)** ì‹œìŠ¤í…œ

### í•´ê²°í•˜ëŠ” ë¬¸ì œ
1. ìˆ˜ë™ íŒŒë¼ë¯¸í„° ì¡°ì •ì˜ ë¹„íš¨ìœ¨ì„± â†’ **Optuna ìžë™ ìµœì í™”**
2. ê³¼ìµœì í™”(Overfitting) ë°©ì§€ â†’ **ë‹¤ì¤‘ ë£©ë°± ê¸°ê°„ ê²€ì¦**
3. ì‹¤ì „ ì ìš© ê°€ëŠ¥í•œ íŒŒë¼ë¯¸í„° ë„ì¶œ â†’ **ê±°ëž˜ë¹„ìš© ë°˜ì˜ ë°±í…ŒìŠ¤íŠ¸**

### í•µì‹¬ ëª©í‘œ
- Sharpe Ratio ìµœëŒ€í™”
- MDD(ìµœëŒ€ ë‚™í­) ìµœì†Œí™”
- ë‹¤ì–‘í•œ ì‹œìž¥ í™˜ê²½ì—ì„œ ì•ˆì •ì ì¸ ì„±ê³¼

---

## â‘¡ ìž…ë ¥ (Input)

### ë°ì´í„° ì†ŒìŠ¤

| ë°ì´í„° | ì†ŒìŠ¤ | ì„¤ëª… |
|--------|------|------|
| ETF ê°€ê²© | pykrx API | ì¼ë³„ OHLCV |
| ETF ìœ ë‹ˆë²„ìŠ¤ | `data/etf_cache.parquet` | í•„í„°ë§ëœ ETF ëª©ë¡ (~690ê°œ) |
| ì‹œìž¥ ì§€ìˆ˜ | KOSPI (1001) | ë ˆì§ ê°ì§€ìš© |

### íŠœë‹ íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | ë²”ìœ„ | ìš©ë„ |
|----------|------|------|
| `ma_period` | 20~200 | ëª¨ë©˜í…€ ìŠ¤ì½”ì–´ ê³„ì‚°ìš© ì´ë™í‰ê·  ê¸°ê°„ |
| `rsi_period` | 5~30 | RSI ê³„ì‚° ê¸°ê°„ (í˜„ìž¬ ë¯¸ì‚¬ìš© âš ï¸) |
| `stop_loss` | -5%~-20% | ì†ì ˆ ê¸°ì¤€ (í˜„ìž¬ ë¯¸ì‚¬ìš© âš ï¸) |
| `max_positions` | 5~15 | ìµœëŒ€ ë³´ìœ  ì¢…ëª© ìˆ˜ |

### ì„¤ì • íŒŒì¼

| íŒŒì¼ | ìš©ë„ |
|------|------|
| `config/backtest.yaml` | íŠœë‹ ë³€ìˆ˜ ì •ì˜, ë¹„ìš© ì„¤ì • |
| `config/config.yaml` | ì „ì—­ ì„¤ì • |
| `config/regime_params.yaml` | ë ˆì§ ê°ì§€ íŒŒë¼ë¯¸í„° |

---

## â‘¢ ì²˜ë¦¬ ë¡œì§ (Logic Flow)

### ì „ì²´ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         UI (React)                               â”‚
â”‚  [íŠœë‹ ì‹œìž‘] â†’ Trials, Lookback ì„¤ì •                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTP POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API ì„œë²„ (api_backtest.py)                    â”‚
â”‚  Port 8001, Hot Reload í™œì„±í™”                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 TuningService (tuning_service.py)                â”‚
â”‚  - Optuna Study ìƒì„±                                            â”‚
â”‚  - íŒŒë¼ë¯¸í„° ìƒ˜í”Œë§ (ma_period, rsi_period, stop_loss ë“±)        â”‚
â”‚  - BacktestService í˜¸ì¶œ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BacktestService (backtest_service.py)              â”‚
â”‚  - ê°€ê²© ë°ì´í„° ë¡œë“œ (90ì¼ ë£©ë°± ë²„í¼ í¬í•¨)                       â”‚
â”‚  - ìœ ë‹ˆë²„ìŠ¤ í•„í„°ë§                                              â”‚
â”‚  - BacktestRunner í˜¸ì¶œ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BacktestRunner (runner.py)                      â”‚
â”‚  - ëª¨ë©˜í…€ ìŠ¤ì½”ì–´ ê³„ì‚° (_calculate_momentum_scores)              â”‚
â”‚  - Top N ì¢…ëª© ì„ ì • (5ì˜ì—…ì¼ë§ˆë‹¤ ë¦¬ë°¸ëŸ°ì‹±)                       â”‚
â”‚  - BacktestEngine í˜¸ì¶œ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BacktestEngine (backtest.py)                    â”‚
â”‚  - ë§¤ìˆ˜/ë§¤ë„ ì‹¤í–‰                                               â”‚
â”‚  - NAV ì—…ë°ì´íŠ¸                                                 â”‚
â”‚  - ê±°ëž˜ë¹„ìš© ê³„ì‚° (ìˆ˜ìˆ˜ë£Œ, ìŠ¬ë¦¬í”¼ì§€, ì„¸ê¸ˆ)                       â”‚
â”‚  - ì„±ê³¼ ì§€í‘œ ê³„ì‚° (CAGR, Sharpe, MDD, ë³€ë™ì„± ë“±)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ì•Œê³ ë¦¬ì¦˜

#### ëª¨ë©˜í…€ ìŠ¤ì½”ì–´ (MAPS)
```python
# runner.py: _calculate_momentum_scores()
ma = close.rolling(window=ma_period).mean()
maps_score = ((current_price / ma) - 1.0) * 100
```

#### ë¦¬ë°¸ëŸ°ì‹± ë¡œì§
```python
# 5ì˜ì—…ì¼ë§ˆë‹¤ Top N ìž¬ì„ ì •
if day_count % 5 == 0:
    scores = _calculate_momentum_scores(price_data, date, ma_period)
    new_top_n = sorted(scores, reverse=True)[:max_positions]
    # ê¸°ì¡´ ì¢…ëª© ì¤‘ new_top_nì— ì—†ìœ¼ë©´ ë§¤ë„
    # new_top_n ì¤‘ ë¯¸ë³´ìœ  ì¢…ëª© ë§¤ìˆ˜
```

### íŒŒë¼ë¯¸í„° ì—°ê²° í˜„í™©

| íŒŒë¼ë¯¸í„° | ì—°ê²° ìƒíƒœ | ì‚¬ìš© ìœ„ì¹˜ |
|----------|----------|----------|
| `ma_period` | âœ… ì—°ê²°ë¨ | `runner.py` â†’ `_calculate_momentum_scores()` |
| `rsi_period` | âœ… ì—°ê²°ë¨ | `runner.py` â†’ `_calculate_rsi()` â†’ ë¹„ì¤‘ ìŠ¤ì¼€ì¼ë§ |
| `stop_loss` | âœ… ì—°ê²°ë¨ | `runner.py` â†’ ì†ì ˆ ë§¤ë„ íŠ¸ë¦¬ê±° |
| `max_positions` | âœ… ì—°ê²°ë¨ | `BacktestEngine` ìƒì„±ìž |

### RSI ë¹„ì¤‘ ìŠ¤ì¼€ì¼ë§ ê·œì¹™

```python
def _get_rsi_exposure(rsi):
    if rsi >= 80: return 0.0   # ê·¹ë‹¨ì  ê³¼ì—´ â†’ ë¹„ì¤‘ 0
    if rsi >= 70: return 0.5   # ê³¼ì—´ â†’ ë¹„ì¤‘ 50%
    if rsi >= 60: return 0.8   # ê²½ê³„ â†’ ë¹„ì¤‘ 80%
    if rsi <= 30: return 1.2   # ê³¼ë§¤ë„ â†’ ë¹„ì¤‘ 120%
    return 1.0                  # ì •ìƒ â†’ ë¹„ì¤‘ 100%
```

**ì ìš© ìˆœì„œ**:
1. ëª¨ë©˜í…€ ê¸°ë°˜ base_weight ê³„ì‚° (ë™ì¼ ë¹„ì¤‘)
2. RSI exposure ì ìš© â†’ ì •ê·œí™” (í•©ê³„ 1.0)
3. ë ˆì§ ìŠ¤ì¼€ì¼ë§ ì ìš© (position_ratio)

---

## â‘£ ì¶œë ¥ (Output)

### ì„±ê³¼ ì§€í‘œ

| ì§€í‘œ | ì„¤ëª… | ì •ìƒ ë²”ìœ„ |
|------|------|----------|
| CAGR | ì—°í‰ê·  ë³µë¦¬ ìˆ˜ìµë¥  | 10~30% (1ë…„ ì´ìƒ) |
| Sharpe Ratio | ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ | 0.5~2.0 |
| MDD | ìµœëŒ€ ë‚™í­ | 5~20% |
| Volatility | ì—°ìœ¨í™” ë³€ë™ì„± | 10~25% |
| Win Rate | ìŠ¹ë¥  (ì¼ë³„ ê¸°ì¤€) | 45~60% |
| Calmar Ratio | CAGR / MDD | 1.0~3.0 |

### ê±°ëž˜ ë¶„ì„

| í•­ëª© | ì„¤ëª… |
|------|------|
| ì´ ê±°ëž˜ | ë§¤ìˆ˜ + ë§¤ë„ íšŸìˆ˜ |
| ë§¤ë„ ê±°ëž˜ | ë§¤ë„ë§Œ ì¹´ìš´íŠ¸ (0ì´ë©´ ë²„ê·¸) |
| í‰ê·  ìˆ˜ìµ/ì†ì‹¤ | ë§¤ë„ ê±°ëž˜ ê¸°ì¤€ |
| ì†ìµë¹„ | í‰ê·  ìˆ˜ìµ / |í‰ê·  ì†ì‹¤| |

### ê²°ê³¼ ì €ìž¥

| ì €ìž¥ ìœ„ì¹˜ | ë‚´ìš© |
|----------|------|
| `data/krx_alertor.db` | ë°±í…ŒìŠ¤íŠ¸ ížˆìŠ¤í† ë¦¬, íŠœë‹ ì„¸ì…˜ |
| `data/optimal_params.json` | ìµœì  íŒŒë¼ë¯¸í„° (ì˜êµ¬ ì €ìž¥) |

---

## â‘¤ ì œì•½ì‚¬í•­ / ê·œì¹™ (Constraints & Rules)

### ì½”ë”© ê·œì¹™ (global_rules.md)

1. **í•˜ë“œì½”ë”© ê¸ˆì§€**: ê¸°ì¤€ì •ë³´ ë˜ëŠ” ì„¤ì •ì—ì„œ ê°’ì„ ì½ì–´ì˜¬ ê²ƒ
2. **ë‹¨ì¼ ì±…ìž„ ì›ì¹™**: 1 íŒŒì¼ 1 ê¸°ëŠ¥
3. **ê²°ì¸¡ì¹˜ ì²˜ë¦¬**: forward fill, ë¹„ì •ìƒ ë°ì´í„°ëŠ” ì œì™¸ í›„ ë¡œê·¸
4. **ì—ëŸ¬ ì²˜ë¦¬**: í•„ìˆ˜ ì„¤ì •ê°’ ëˆ„ë½ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë°œìƒ
5. **í¬ë§·íŒ…**: ìˆ˜ì • í›„ `black`, `flake8` ì‹¤í–‰

### í…ŒìŠ¤íŠ¸ ê·œì¹™

1. **API ì„œë²„ Hot Reload**: ì½”ë“œ ìˆ˜ì • ì‹œ ìžë™ ë°˜ì˜ (`reload=True`)
2. **í…ŒìŠ¤íŠ¸ ê²½ë¡œ ì¼ì¹˜**: ì§ì ‘ Python ì‹¤í–‰ í…ŒìŠ¤íŠ¸ â‰  UI ê²½ìœ  í…ŒìŠ¤íŠ¸
   - UI í…ŒìŠ¤íŠ¸ ì‹œ ë°˜ë“œì‹œ API ì„œë²„ ê²½ìœ  í™•ì¸
3. **íŒŒë¼ë¯¸í„° ì—°ê²° ê²€ì¦**: ëª¨ë“  íŠœë‹ íŒŒë¼ë¯¸í„°ê°€ ì‹¤ì œ ë¡œì§ì—ì„œ ì‚¬ìš©ë˜ëŠ”ì§€ í™•ì¸

### ë””ë²„ê¹… ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ ëª¨ë“  ìž…ë ¥ íŒŒë¼ë¯¸í„°ê°€ ì‹¤ì œ ë¡œì§ì—ì„œ ì‚¬ìš©ë˜ëŠ”ì§€ ì¶”ì 
â–¡ UI â†’ API â†’ Service â†’ Engine â†’ ê³„ì‚° í•¨ìˆ˜ ì „ì²´ íë¦„ ê²€ì¦
â–¡ íŒŒë¼ë¯¸í„° ë³€ê²½ ì‹œ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ”ì§€ í™•ì¸
â–¡ ë³€ë™ì„± 0%, ë§¤ë„ 0íšŒ ë“± ë¹„ì •ìƒ ì§€í‘œ ì²´í¬
```

### í´ë” êµ¬ì¡°

```
krx_alertor_modular/
â”œâ”€â”€ api_backtest.py          # íŠœë‹ API ì„œë²„ (Port 8001)
â”œâ”€â”€ app/services/
â”‚   â”œâ”€â”€ backtest_service.py  # ë°±í…ŒìŠ¤íŠ¸ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ tuning_service.py    # íŠœë‹ ì„œë¹„ìŠ¤ (Optuna)
â”œâ”€â”€ extensions/backtest/
â”‚   â””â”€â”€ runner.py            # ë°±í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ (ëª¨ë©˜í…€ ë¡œì§)
â”œâ”€â”€ core/engine/
â”‚   â””â”€â”€ backtest.py          # ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ (ë§¤ë§¤ ì‹¤í–‰)
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ backtest.yaml        # íŠœë‹ ë³€ìˆ˜ ì •ì˜
â”‚   â””â”€â”€ config.yaml          # ì „ì—­ ì„¤ì •
â””â”€â”€ data/
    â”œâ”€â”€ etf_cache.parquet    # ETF ìºì‹œ
    â””â”€â”€ optimal_params.json  # ìµœì  íŒŒë¼ë¯¸í„°
```

---

## âš ï¸ í˜„ìž¬ ì•Œë ¤ì§„ ì´ìŠˆ

### í•´ê²°ë¨ (2025-12-09)
- âœ… `rsi_period`: RSI ê³„ì‚° ë° ë¹„ì¤‘ ìŠ¤ì¼€ì¼ë§ì— ì‚¬ìš©
- âœ… `stop_loss`: ì†ì ˆ ë§¤ë„ íŠ¸ë¦¬ê±° êµ¬í˜„
- âœ… RSI ê³„ì‚° ì‹œ uint32 overflow ë²„ê·¸ ìˆ˜ì •

### ì¶”ê°€ ê°œì„  ê°€ëŠ¥
1. RSI ìŠ¤ì¼€ì¼ë§ ìž„ê³„ê°’ íŠœë‹ (í˜„ìž¬ ê³ ì •ê°’)
2. ë ˆì§ ìŠ¤ì¼€ì¼ë§ê³¼ RSI ìŠ¤ì¼€ì¼ë§ ì¶©ëŒ ë°©ì§€ êµ¬ì¡°
3. UIì— "ë¹„ì¤‘ ì¡°ì ˆ ížˆíŠ¸ë§µ" í‘œì‹œ

---

## ðŸ¤– AI í˜‘ì—… ê°€ì´ë“œ

### Cascade (Claude) ê°•ì 
- ì½”ë“œ ê²€ìƒ‰, ìˆ˜ì •, ê°œë³„ ê¸°ëŠ¥ êµ¬í˜„
- íŠ¹ì • ì¦ìƒ ìˆ˜ì •

### Cascade (Claude) ì•½ì 
- ì „ì²´ ì‹œìŠ¤í…œ íë¦„ íŒŒì•…
- ëˆ„ë½ëœ ì—°ê²° ì‚¬ì „ ì‹ë³„
- Plan ìˆ˜ë¦½ ì‹œ ë§¹ì  ë°œìƒ ê°€ëŠ¥

### ê¶Œìž¥ í˜‘ì—… ë°©ì‹
1. **Plan ìˆ˜ë¦½**: ë‹¤ë¥¸ AI (ChatGPT ë“±)ì—ê²Œ ê²€í†  ìš”ì²­
2. **Plan ë³´ì™„**: Cascadeê°€ ì„¸ë¶€ ì‚¬í•­ ì¶”ê°€
3. **ì‹¤í–‰**: Cascadeê°€ ì½”ë“œ ìˆ˜ì •
4. **ê²€ì¦**: ì‚¬ìš©ìžê°€ UIì—ì„œ End-to-End í…ŒìŠ¤íŠ¸

---

## ðŸ“‹ ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| 2025-12-08 | 1.0 | ì´ˆê¸° ìž‘ì„± |
