# Phase 3 Week 2: 실제 보유 종목 백테스트 (2025-11-11)

## 🎯 **목표**

실제 보유 종목으로 백테스트를 수행하여 **최적 손절 시점**을 찾습니다.

### **핵심 질문**
```
1. SK증권을 언제 팔았어야 하는가?
   현재 손실: -40.85% (-1,446,000원)

2. 카카오뱅크 최적 손절 시점은?
   현재 손실: -66.58% (-216,150원)

3. 하이즈항공 손실 최소화 방법은?
   현재 손실: -58.88% (-160,750원)
```

---

## 📊 **백테스트 결과**

### **전체 포트폴리오 현황**
```
총 28개 종목 분석
- 수익 종목: 18개 ✅
- 손실 종목: 10개 ⚠️
- 손절 대상: 2개 🎯
```

---

## 🎯 **손절 분석 결과**

### **1. 하이즈항공 (221840)**

#### **현재 상황**
```
매입가: 5,460원 × 50주 = 273,000원
현재가: 2,245원
손실률: -58.88%
손실액: -160,750원
```

#### **최적 손절**
```
날짜: 2023-11-13
가격: 2,840원
손절률: -47.99%
절약: +29,750원 (+10.90%p) 💰
```

#### **분석**
```
✅ 손절 기회 있었음
- 매입가 대비 -48% 지점에서 손절
- 현재 -59% 대비 +11%p 절약
- 절약 금액: 29,750원

⚠️ 교훈:
- 하락 트렌드 초기에 손절 필요
- -50% 손절 룰 적용 시 손실 최소화
```

---

### **2. 카카오뱅크 (323410)**

#### **현재 상황**
```
매입가: 64,930원 × 5주 = 324,650원
현재가: 21,700원
손실률: -66.58%
손실액: -216,150원
```

#### **최적 손절**
```
날짜: 2023-11-13
가격: 23,250원
손절률: -64.19%
절약: +7,750원 (+2.39%p) 💰
```

#### **분석**
```
⚠️ 손절 기회 제한적
- 매입가 대비 -64% 지점에서 손절
- 현재 -67% 대비 +2%p 절약
- 절약 금액: 7,750원

⚠️ 교훈:
- 이미 큰 손실 후 손절 시점
- -30% 손절 룰 적용 시 더 큰 절약 가능
```

---

### **3. SK증권 (001510)**

#### **현재 상황**
```
매입가: 1,180원 × 3,000주 = 3,540,000원
현재가: 698원
손실률: -40.85%
손실액: -1,446,000원
```

#### **최적 손절**
```
⚠️ 손절 없이 보유 (현재 전략 유지)
```

#### **분석**
```
❌ 손절 기회 없음 (데이터 제한)
- 2년 데이터 내에서 손절 시점 없음
- 매입일 정보 필요
- 정확한 분석 불가

⚠️ 교훈:
- 매입일 정보 필수
- 장기 보유 종목 분석 어려움
```

---

## 📈 **기타 손실 종목 분석**

### **손절 없이 보유가 최선인 종목**

#### **1. 맥쿼리인프라 (088980)**
```
매입가: 12,373원
현재가: 11,290원
손실률: -8.75%

✅ 손절 불필요
- 손실 10% 미만
- 배당주 특성상 장기 보유
```

#### **2. KODEX 베트남VN30 (245710)**
```
매입가: 30,572원
현재가: 28,620원
손실률: -6.38%

✅ 손절 불필요
- 손실 10% 미만
- 신흥국 ETF 특성상 변동성 높음
```

#### **3. TIGER 글로벌리튬&2차전지SOLACTIVE (394670)**
```
매입가: 9,835원
현재가: 9,680원
손실률: -1.58%

✅ 손절 불필요
- 손실 2% 미만
- 테마주 특성상 반등 가능성
```

#### **4. PLUS 글로벌희토류&전략자원생산기업 (415920)**
```
매입가: 8,030원
현재가: 6,710원
손실률: -16.44%

⚠️ 모니터링 필요
- 손실 15% 초과
- -20% 손절 기준 근접
```

#### **5. TIMEFOLIO 글로벌AI인공지능액티브 (456600)**
```
매입가: 39,085원
현재가: 37,970원
손실률: -2.85%

✅ 손절 불필요
- 손실 3% 미만
- AI 테마 장기 성장 기대
```

#### **6. SOL 미국AI전력인프라 (486450)**
```
매입가: 21,672원
현재가: 21,355원
손실률: -1.46%

✅ 손절 불필요
- 손실 2% 미만
- AI 인프라 테마 성장 기대
```

#### **7. TIGER 글로벌AI전력인프라액티브 (491010)**
```
매입가: 21,050원
현재가: 20,760원
손실률: -1.38%

✅ 손절 불필요
- 손실 2% 미만
- AI 인프라 테마 성장 기대
```

---

## 💡 **핵심 인사이트**

### **1. 손절 타이밍의 중요성**

```
하이즈항공 사례:
- -48% 손절 → -59% 현재
- 절약: +11%p (29,750원)

카카오뱅크 사례:
- -64% 손절 → -67% 현재
- 절약: +2%p (7,750원)

✅ 교훈:
- 손절은 빠를수록 좋다
- -30% 손절 룰 적용 시 더 큰 절약
```

---

### **2. 손절 기준의 필요성**

```
현재 포트폴리오:
- 손실 10개 종목 중 2개만 손절 기회
- 나머지 8개는 손절 없이 보유가 최선

⚠️ 문제:
- 손절 기준이 없어서 판단 어려움
- 손실 -10%, -20%, -30% 중 어디서 손절?

✅ 해결:
- 손절 기준 설정 필요
- 종목별 특성 고려 필요
```

---

### **3. 매입일 정보의 중요성**

```
SK증권 사례:
- 현재 -40.85% 손실
- 하지만 손절 시점 분석 불가
- 이유: 매입일 정보 없음

⚠️ 문제:
- 2년 데이터만 조회
- 매입일이 그 이전이면 분석 불가

✅ 해결:
- holdings.json에 매입일 추가 필요
- 매입일부터 현재까지 전체 데이터 조회
```

---

## 🎯 **최적 손절 전략 제안**

### **손절 기준 (종목 특성별)**

#### **1. 개별 주식**
```
- 1차 손절: -15% (경고)
- 2차 손절: -25% (강제)
- 3차 손절: -35% (최종)

예: SK증권, 카카오뱅크, 하이즈항공
```

#### **2. 섹터 ETF**
```
- 1차 손절: -20% (경고)
- 2차 손절: -30% (강제)

예: KODEX 반도체, TIGER 2차전지
```

#### **3. 지수 ETF**
```
- 1차 손절: -25% (경고)
- 2차 손절: -35% (강제)

예: KODEX 200, TIGER 미국S&P500
```

#### **4. 배당주/인프라**
```
- 1차 손절: -30% (경고)
- 2차 손절: -40% (강제)

예: 맥쿼리인프라, PLUS 고배당주
```

---

## 📊 **백테스트 한계점**

### **1. 데이터 제한**
```
❌ 문제:
- 2년 데이터만 조회
- 매입일 정보 없음
- 장기 보유 종목 분석 불가

✅ 해결:
- holdings.json에 매입일 추가
- 매입일부터 현재까지 전체 데이터 조회
```

### **2. 손절 기준 단순화**
```
❌ 문제:
- -10%, -15%, -20%, -25%, -30% 고정
- 종목 특성 미반영
- 시장 상황 미반영

✅ 해결:
- 종목별 손절 기준 차별화
- 시장 레짐 반영 (상승장/하락장)
- 변동성 고려
```

### **3. 재매수 타이밍 미분석**
```
❌ 문제:
- 손절 후 재매수 시점 분석 없음
- 손절 후 반등 시 기회 상실

✅ 해결:
- 재매수 조건 설정
- 기술적 지표 활용 (RSI, MACD)
```

---

## 🚀 **다음 단계 (Phase 3 Week 3)**

### **파라미터 최적화 (Optuna)**

```python
# 목표: 최적 손절 비율 찾기
optimize_stop_loss(
    stock_types=['개별주', '섹터ETF', '지수ETF', '배당주'],
    stop_loss_range=[10, 15, 20, 25, 30, 35, 40],
    market_regimes=['상승장', '중립장', '하락장']
)

# 예상 결과:
개별주:
- 상승장: -25% 손절
- 중립장: -20% 손절
- 하락장: -15% 손절

섹터ETF:
- 상승장: -30% 손절
- 중립장: -25% 손절
- 하락장: -20% 손절

지수ETF:
- 상승장: -35% 손절
- 중립장: -30% 손절
- 하락장: -25% 손절
```

---

## 📝 **변경 파일**

### **신규**
```
scripts/phase3/backtest_holdings.py
- 보유 종목 백테스트 스크립트
- 최적 손절 시점 분석
- 리포트 생성

data/output/holdings_backtest_result.json
- 백테스트 결과 (JSON)

data/output/holdings_backtest_report.txt
- 백테스트 리포트 (텍스트)

docs/PHASE3_WEEK2_HOLDINGS_BACKTEST.md
- 백테스트 문서
```

---

## ✅ **완료 체크리스트**

- [x] 보유 종목 백테스트 스크립트 구현
- [x] 최적 손절 시점 분석
- [x] 리포트 생성
- [x] 문서화 완료
- [ ] 매입일 정보 추가 (다음 단계)
- [ ] 파라미터 최적화 (Week 3)

---

## 🎉 **최종 결과**

### **백테스트 성과**
```
총 절약 가능 금액: +37,500원 💰

하이즈항공: +29,750원 (+10.90%p)
카카오뱅크: +7,750원 (+2.39%p)
```

### **핵심 교훈**
```
1. 손절은 빠를수록 좋다
   - -30% 손절 룰 적용 시 손실 최소화

2. 종목별 손절 기준 필요
   - 개별주: -15% ~ -25%
   - 섹터ETF: -20% ~ -30%
   - 지수ETF: -25% ~ -35%

3. 매입일 정보 필수
   - 정확한 백테스트를 위해 필요
   - holdings.json에 추가 예정
```

### **다음 액션**
```
Week 3: 파라미터 최적화
- Optuna로 최적 손절 비율 찾기
- 시장 레짐별 손절 전략
- 재매수 타이밍 분석
```

**백테스트 완료! 이제 최적 파라미터를 찾아봅시다!** 🚀
