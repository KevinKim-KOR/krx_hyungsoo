# Phase 2: μµμ ν™” λ° κ²€μ¦ κ°€μ΄λ“

## π“‹ κ°μ”

Phase 2μ—μ„λ” MAPS μ „λµμ νλΌλ―Έν„° μµμ ν™” λ° κ²€μ¦μ„ μ„ν• 3κ°€μ§€ ν•µμ‹¬ λ„κµ¬λ¥Ό κµ¬ν„ν–μµλ‹λ‹¤:

1. **Optuna νλΌλ―Έν„° μµμ ν™”**: μµμ  νλΌλ―Έν„° νƒμƒ‰
2. **μ›ν¬ν¬μ›λ“ λ¶„μ„**: μ‹κ°„μ— λ”°λ¥Έ μ „λµ μ•μ •μ„± κ²€μ¦
3. **λ΅λ²„μ¤νΈλ‹μ¤ ν…μ¤νΈ**: λ‹¤μ–‘ν• μ΅°κ±΄μ—μ„μ μ „λµ κ°•κ±΄μ„± ν‰κ°€

---

## π― 1. Optuna νλΌλ―Έν„° μµμ ν™”

### λ©μ 
MAPS μ „λµμ μµμ  νλΌλ―Έν„°λ¥Ό μλ™μΌλ΅ νƒμƒ‰ν•©λ‹λ‹¤.

### μµμ ν™” νλΌλ―Έν„°

| νλΌλ―Έν„° | λ²”μ„ | μ„¤λ… |
|---------|------|------|
| `ma_period` | 20~120 (step 10) | μ΄λ™ν‰κ·  κΈ°κ°„ |
| `rsi_period` | 7~21 (step 2) | RSI κΈ°κ°„ |
| `rsi_overbought` | 65~80 (step 5) | RSI κ³Όλ§¤μ μ„κ³„κ°’ |
| `maps_buy_threshold` | -2.0~5.0 (step 1.0) | MAPS λ§¤μ μ„κ³„κ°’ |
| `maps_sell_threshold` | -10.0~-2.0 (step 1.0) | MAPS λ§¤λ„ μ„κ³„κ°’ |
| `rebalance_frequency` | weekly/biweekly/monthly | λ¦¬λ°Έλ°μ‹± μ£ΌκΈ° |
| `max_positions` | 5~20 (step 5) | μµλ€ λ³΄μ  μΆ…λ© μ |
| `min_confidence` | 0.0~0.3 (step 0.05) | μµμ† μ‹ λΆ°λ„ |

### λ©μ  ν•¨μ
```
λ©μ ν•¨μ = μ—°μ¨ν™” μμµλ¥  - Ξ» Γ— MDD
(κΈ°λ³Έ Ξ» = 2.0)
```

### μ‚¬μ©λ²•

#### λΉ λ¥Έ ν…μ¤νΈ (20 trials, ~10λ¶„)
```bash
python pc/cli.py optimize \
  --start 2024-01-01 \
  --end 2024-06-30 \
  --trials 20 \
  --seed 42
```

#### μ „μ²΄ μµμ ν™” (100 trials, ~1μ‹κ°„)
```bash
python pc/cli.py optimize \
  --start 2024-01-01 \
  --end 2024-12-30 \
  --trials 100 \
  --seed 42 \
  --output reports/optuna/full
```

### μ¶λ ¥
- `best_params.yaml`: μµμ  νλΌλ―Έν„°
- `study_report.md`: μµμ ν™” λ¦¬ν¬νΈ
- `study.db`: Optuna study λ°μ΄ν„°λ² μ΄μ¤
- `optimization_history.html`: μµμ ν™” νμ¤ν† λ¦¬ (--plot μµμ…)
- `param_importances.html`: νλΌλ―Έν„° μ¤‘μ”λ„ (--plot μµμ…)

---

## π”„ 2. μ›ν¬ν¬μ›λ“ λ¶„μ„

### λ©μ 
μ‹κ°„μ— λ”°λ¥Έ μ „λµμ μ•μ •μ„±μ„ κ²€μ¦ν•©λ‹λ‹¤. κ³Όκ±° λ°μ΄ν„°λ΅ μµμ ν™”ν• νλΌλ―Έν„°κ°€ λ―Έλμ—λ„ μ ν¨ν•μ§€ ν™•μΈν•©λ‹λ‹¤.

### μλ„μ° νƒ€μ…

#### μ¬λΌμ΄λ”© μλ„μ° (Sliding Window)
```
[ν•™μµ 12κ°μ›”] β†’ [κ²€μ¦ 3κ°μ›”]
         [ν•™μµ 12κ°μ›”] β†’ [κ²€μ¦ 3κ°μ›”]
                  [ν•™μµ 12κ°μ›”] β†’ [κ²€μ¦ 3κ°μ›”]
```
- κ³ μ •λ ν•™μµ κΈ°κ°„ μ‚¬μ©
- μµκ·Ό λ°μ΄ν„°μ— λ” λ―Όκ°

#### ν™•μ¥ μλ„μ° (Expanding Window)
```
[ν•™μµ 12κ°μ›”] β†’ [κ²€μ¦ 3κ°μ›”]
[ν•™μµ 15κ°μ›”] β†’ [κ²€μ¦ 3κ°μ›”]
[ν•™μµ 18κ°μ›”] β†’ [κ²€μ¦ 3κ°μ›”]
```
- λ„μ  ν•™μµ (λ¨λ“  κ³Όκ±° λ°μ΄ν„° μ‚¬μ©)
- μ¥κΈ° νΈλ λ“ ν¬μ°©

### μ‚¬μ©λ²•

#### μ¬λΌμ΄λ”© μλ„μ°
```bash
python pc/cli.py walk-forward \
  --start 2023-01-01 \
  --end 2024-12-30 \
  --train-months 12 \
  --test-months 3 \
  --window-type sliding \
  --trials 30 \
  --output reports/walk_forward/sliding
```

#### ν™•μ¥ μλ„μ°
```bash
python pc/cli.py walk-forward \
  --start 2023-01-01 \
  --end 2024-12-30 \
  --train-months 12 \
  --test-months 3 \
  --window-type expanding \
  --trials 30 \
  --output reports/walk_forward/expanding
```

### μ¶λ ¥
- `walk_forward_results.csv`: μλ„μ°λ³„ κ²°κ³Ό μ”μ•½
- `walk_forward_results.json`: μƒμ„Έ κ²°κ³Ό (νλΌλ―Έν„° ν¬ν•¨)

### κ²°κ³Ό ν•΄μ„
- **ν‰κ·  κ²€μ¦ μμµλ¥ **: λ―Έλ μ„±κ³Ό μμΈ΅
- **ν‰κ·  κ²€μ¦ μƒ¤ν”„**: μ„ν— μ΅°μ • μμµλ¥ 
- **μΉλ¥ **: μ–‘μ μμµλ¥  λΉ„μ¨
- **ν•™μµ vs κ²€μ¦ μ°¨μ΄**: κ³Όμ ν•© μ •λ„

---

## π”¬ 3. λ΅λ²„μ¤νΈλ‹μ¤ ν…μ¤νΈ

### λ©μ 
λ‹¤μ–‘ν• μ΅°κ±΄μ—μ„ μ „λµμ κ°•κ±΄μ„±μ„ ν‰κ°€ν•©λ‹λ‹¤.

### ν…μ¤νΈ ν•­λ©

#### 1. μ‹λ“ λ³€λ™ ν…μ¤νΈ
- λλ¤ μ‹λ“λ¥Ό λ³€κ²½ν•μ—¬ 30ν λ°λ³µ
- κ²°κ³Όμ μ•μ •μ„± ν™•μΈ

#### 2. μƒν” λ“λ΅­ ν…μ¤νΈ
- λ°μ΄ν„° λ„λ½ μ‹λ®¬λ μ΄μ… (5%, 10%, 15%, 20%)
- λ°μ΄ν„° ν’μ§ μ €ν• μ‹ μ„±λ¥ ν™•μΈ

#### 3. λ¶€νΈμ¤νΈλ© ν…μ¤νΈ
- λ³µμ› μ¶”μ¶λ΅ 30ν λ°λ³µ
- 95% μ‹ λΆ°κµ¬κ°„ κ³„μ‚°

#### 4. μμλ£ λ―Όκ°λ„
- μμλ£μ¨ λ³€ν™”μ— λ”°λ¥Έ μ„±κ³Ό λ³€ν™”
- 0%, 0.005%, 0.015%, 0.03%, 0.05%

#### 5. μ¬λ¦¬ν”Όμ§€ λ―Όκ°λ„
- μ¬λ¦¬ν”Όμ§€μ¨ λ³€ν™”μ— λ”°λ¥Έ μ„±κ³Ό λ³€ν™”
- 0%, 0.05%, 0.1%, 0.2%, 0.5%

### μ‚¬μ©λ²•

#### 1. νλΌλ―Έν„° νμΌ μ¤€λΉ„
```json
{
  "ma_period": 60,
  "rsi_period": 14,
  "rsi_overbought": 70,
  "maps_buy_threshold": 0.0,
  "maps_sell_threshold": -5.0,
  "rebalance_frequency": "monthly",
  "max_positions": 10,
  "min_confidence": 0.1
}
```

#### 2. ν…μ¤νΈ μ‹¤ν–‰
```bash
python pc/cli.py robustness \
  --start 2024-01-01 \
  --end 2024-12-30 \
  --params best_params.json \
  --iterations 30 \
  --output reports/robustness/test1
```

### μ¶λ ¥
- `seed_variation.csv`: μ‹λ“ λ³€λ™ κ²°κ³Ό
- `sample_drop.csv`: μƒν” λ“λ΅­ κ²°κ³Ό
- `bootstrap.csv`: λ¶€νΈμ¤νΈλ© κ²°κ³Ό
- `commission_sensitivity.csv`: μμλ£ λ―Όκ°λ„
- `slippage_sensitivity.csv`: μ¬λ¦¬ν”Όμ§€ λ―Όκ°λ„

### κ²°κ³Ό ν•΄μ„
- **μ‹λ“ λ³€λ™**: ν‘μ¤€νΈμ°¨κ°€ μ‘μ„μλ΅ μ•μ •μ 
- **μƒν” λ“λ΅­**: λ„λ½λ¥  μ¦κ°€μ—λ„ μ„±κ³Ό μ μ§€ μ‹ κ°•κ±΄
- **λ¶€νΈμ¤νΈλ©**: 95% μ‹ λΆ°κµ¬κ°„μ΄ μΆμ„μλ΅ μ‹ λΆ°λ„ λ†’μ
- **μμλ£/μ¬λ¦¬ν”Όμ§€**: λ―Όκ°λ„κ°€ λ‚®μ„μλ΅ μ‹¤μ „ μ μ© μ λ¦¬

---

## π“ κ¶μ¥ μ›ν¬ν”λ΅μ°

### Step 1: νλΌλ―Έν„° μµμ ν™”
```bash
# μ†κ·λ¨ ν…μ¤νΈ
python pc/cli.py optimize --start 2024-01-01 --end 2024-06-30 --trials 20

# κ²°κ³Ό ν™•μΈ ν›„ μ „μ²΄ μµμ ν™”
python pc/cli.py optimize --start 2024-01-01 --end 2024-12-30 --trials 100 --output reports/optuna/full
```

### Step 2: μ›ν¬ν¬μ›λ“ κ²€μ¦
```bash
# μ¬λΌμ΄λ”© μλ„μ°
python pc/cli.py walk-forward --start 2023-01-01 --end 2024-12-30 --window-type sliding --trials 30

# ν™•μ¥ μλ„μ°
python pc/cli.py walk-forward --start 2023-01-01 --end 2024-12-30 --window-type expanding --trials 30
```

### Step 3: λ΅λ²„μ¤νΈλ‹μ¤ ν™•μΈ
```bash
# μµμ  νλΌλ―Έν„°λ΅ λ΅λ²„μ¤νΈλ‹μ¤ ν…μ¤νΈ
python pc/cli.py robustness --start 2024-01-01 --end 2024-12-30 --params reports/optuna/full/best_params.yaml --iterations 30
```

### Step 4: μµμΆ… λ°±ν…μ¤νΈ
```bash
# μµμ  νλΌλ―Έν„°λ΅ μ „μ²΄ κΈ°κ°„ λ°±ν…μ¤νΈ
python pc/cli.py backtest --start 2023-01-01 --end 2024-12-30 --max-positions 10
```

---

## π― μ„±κ³µ κΈ°μ¤€

### Optuna μµμ ν™”
- β… λ©μ ν•¨μ κ°’ > 10.0 (μ—°μ¨ν™” μμµλ¥  - 2Γ—MDD)
- β… μƒ¤ν”„ λΉ„μ¨ > 1.0
- β… MDD < -15%

### μ›ν¬ν¬μ›λ“ λ¶„μ„
- β… ν‰κ·  κ²€μ¦ μμµλ¥  > 5%
- β… μΉλ¥  > 50%
- β… ν•™μµ-κ²€μ¦ μ°¨μ΄ < 10%p

### λ΅λ²„μ¤νΈλ‹μ¤ ν…μ¤νΈ
- β… μ‹λ“ λ³€λ™ ν‘μ¤€νΈμ°¨ < 5%
- β… 20% μƒν” λ“λ΅­ μ‹ μμµλ¥  > 0%
- β… λ¶€νΈμ¤νΈλ© 95% μ‹ λΆ°κµ¬κ°„ μ–‘μ
- β… 0.03% μμλ£ μ‹ μμµλ¥  > 0%

---

## π”§ νΈλ¬λΈ”μν…

### λ¬Έμ : μµμ ν™”κ°€ λ„λ¬΄ λλ¦Ό
**ν•΄κ²°**: trials μλ¥Ό μ¤„μ΄κ±°λ‚ κΈ°κ°„μ„ λ‹¨μ¶•
```bash
python pc/cli.py optimize --start 2024-01-01 --end 2024-06-30 --trials 20
```

### λ¬Έμ : μ›ν¬ν¬μ›λ“ μλ„μ°κ°€ μƒμ„±λμ§€ μ•μ
**ν•΄κ²°**: ν•™μµ+κ²€μ¦ κΈ°κ°„μ΄ μ „μ²΄ κΈ°κ°„λ³΄λ‹¤ μ§§μ€μ§€ ν™•μΈ
```bash
# μ „μ²΄ 2λ…„ κΈ°κ°„μ— ν•™μµ 12κ°μ›” + κ²€μ¦ 3κ°μ›” = μµμ† 15κ°μ›” ν•„μ”
python pc/cli.py walk-forward --start 2023-01-01 --end 2024-12-30 --train-months 12 --test-months 3
```

### λ¬Έμ : λ΅λ²„μ¤νΈλ‹μ¤ ν…μ¤νΈ μ‹¤ν¨
**ν•΄κ²°**: νλΌλ―Έν„° νμΌ κ²½λ΅ λ° ν•μ‹ ν™•μΈ
```bash
# JSON ν•μ‹ ν™•μΈ
cat best_params.json
```

---

## π“ λ‹¤μ λ‹¨κ³„

Phase 2 μ™„λ£ ν›„:
- β… μµμ  νλΌλ―Έν„° ν™•λ³΄
- β… μ „λµ μ•μ •μ„± κ²€μ¦
- β… κ°•κ±΄μ„± ν™•μΈ

**Phase 3λ΅ μ§„ν–‰**: μ‹¤μ‹κ°„ μ΄μ
- μΌμ¤‘ λ§¤λ§¤ μ‹ νΈ κµ¬ν„
- ν¬μ§€μ… λ³€κ²½ μ•λ¦Ό
- λ μ§ λ³€κ²½ κ°μ§€
- μ›Ή λ€μ‹λ³΄λ“
