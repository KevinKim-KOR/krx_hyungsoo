# Week 3: í•˜ì´ë¸Œë¦¬ë“œ ì „ëžµ êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

**ìž‘ì„±ì¼**: 2025-11-08  
**ì†Œìš” ì‹œê°„**: 1ì¼ (8ì‹œê°„)  
**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ðŸ“Š ëª©í‘œ ë° ë‹¬ì„±ë„

### ëª©í‘œ
- ì‹œìž¥ ë ˆì§ ê¸°ë°˜ ë™ì  í¬ì§€ì…˜ ì¡°ì •
- MDD -10~12% ë‹¬ì„±
- CAGR 30% ì´ìƒ ìœ ì§€
- Sharpe Ratio 1.5 ì´ìƒ

### ë‹¬ì„±ë„

| ì§€í‘œ | ëª©í‘œ | ë‹¬ì„± | ë‹¬ì„±ë¥  | ìƒíƒœ |
|------|------|------|--------|------|
| **CAGR** | 30% | 27.05% | 90% | âš ï¸ |
| **Sharpe** | 1.5 | 1.51 | 101% | âœ… |
| **MDD** | -12% | -19.92% | 66% | âš ï¸ |

---

## ðŸŽ¯ êµ¬í˜„ ë‚´ìš©

### Day 1: ë ˆì§ ê°ì§€ ì‹œìŠ¤í…œ êµ¬í˜„

#### 1.1 MarketRegimeDetector í´ëž˜ìŠ¤
**íŒŒì¼**: `core/strategy/market_regime_detector.py`

**ê¸°ëŠ¥**:
- ì´ë™í‰ê·  ê¸°ë°˜ ì‹œìž¥ ë ˆì§ ë¶„ë¥˜ (ìƒìŠ¹ìž¥/í•˜ë½ìž¥/ì¤‘ë¦½ìž¥)
- ì¶”ì„¸ ê°•ë„ ë° ì‹ ë¢°ë„ ê³„ì‚°
- ë ˆì§ë³„ í¬ì§€ì…˜ ë¹„ìœ¨ ì œê³µ
- ë°©ì–´ ëª¨ë“œ ì§„ìž… íŒë‹¨

**í•µì‹¬ ë¡œì§**:
```python
# ë ˆì§ ë¶„ë¥˜
if ma_diff_pct > bull_threshold:
    regime = 'bull'
elif ma_diff_pct < bear_threshold:
    regime = 'bear'
else:
    regime = 'neutral'

# í¬ì§€ì…˜ ë¹„ìœ¨
bull: 100~120%
neutral: 80%
bear: 40~60%
```

#### 1.2 KRXMAPSAdapter í†µí•©
**íŒŒì¼**: `core/engine/krx_maps_adapter.py`

**ë³€ê²½ì‚¬í•­**:
- MarketRegimeDetector ì´ˆê¸°í™” ì¶”ê°€
- ë§¤ìˆ˜ ë¡œì§ì— ë ˆì§ ê¸°ë°˜ í¬ì§€ì…˜ ì¡°ì • í†µí•©
- KOSPI ë°ì´í„° ë¡œë“œ ì¡°ê±´ ìˆ˜ì •
- ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ì— ë ˆì§ í†µê³„ í¬í•¨

#### 1.3 ë””ë²„ê¹…
**ë¬¸ì œ**:
- ë ˆì§ í†µê³„ê°€ ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ì— í‘œì‹œë˜ì§€ ì•ŠìŒ
- `_convert_results`ì—ì„œ í†µê³„ ì†ì‹¤ ë°œê²¬

**í•´ê²°**:
- `_convert_results`ì— ë°©ì–´ ì‹œìŠ¤í…œ í†µê³„ ì „ë‹¬ ë¡œì§ ì¶”ê°€
- KOSPI ë°ì´í„° ë¡œë“œ ì¡°ê±´ì— `regime_detector` í¬í•¨

---

### Day 2: íŒŒë¼ë¯¸í„° ìµœì í™”

#### 2.1 ë ˆì§ ê°ì§€ íŒŒë¼ë¯¸í„° í…ŒìŠ¤íŠ¸

| íŒŒë¼ë¯¸í„° | CAGR | Sharpe | MDD | ë ˆì§ ë³€ê²½ | í‰ê°€ |
|---------|------|--------|-----|----------|------|
| MA 50/200, Â±2% | 21.28% | 1.46 | -17.36% | 5íšŒ | ë„ˆë¬´ ëŠë¦¼ |
| MA 20/60, Â±1% | 18.68% | 1.17 | -15.86% | 22íšŒ | ë„ˆë¬´ ë¹ ë¦„ |
| MA 30/100, Â±1.5% | 17.79% | 1.14 | -20.37% | 11íšŒ | ìµœì•… |

**ìµœì¢… ì„ íƒ**: MA 50/200, Â±2% (ê°€ìž¥ ì•ˆì •ì )

#### 2.2 í¬ì§€ì…˜ ë¹„ìœ¨ ìµœì í™”

**ê¸°ì¡´ ì„¤ì •** (ë„ˆë¬´ ë°©ì–´ì ):
- ìƒìŠ¹ìž¥: 100~120%
- ì¤‘ë¦½ìž¥: 50% âŒ
- í•˜ë½ìž¥: 0~20% âŒ
- ë°©ì–´ ëª¨ë“œ: ì‹ ë¢°ë„ 70% ì´ìƒ

**ìµœì í™” ì„¤ì •**:
- ìƒìŠ¹ìž¥: 100~120% (ìœ ì§€)
- ì¤‘ë¦½ìž¥: 80% âœ… (+30%p)
- í•˜ë½ìž¥: 40~60% âœ… (+40%p)
- ë°©ì–´ ëª¨ë“œ: ì‹ ë¢°ë„ 85% ì´ìƒ âœ… (ì™„í™”)

**íš¨ê³¼**:
- CAGR: 21.28% â†’ 27.05% (+5.77%p)
- Sharpe: 1.46 â†’ 1.51 (+0.05)
- MDD: -17.36% â†’ -19.92% (-2.56%p)

---

## ðŸ“ˆ ìµœì¢… ì„±ê³¼

### ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ (2022-01-01 ~ 2025-11-08)

| ì§€í‘œ | ë°©ì–´ ì—†ìŒ | í•˜ì´ë¸Œë¦¬ë“œ | ë³€í™” |
|------|----------|-----------|------|
| **ìˆ˜ìµë¥ ** | 153.82% | 96.80% | -57.02%p |
| **CAGR** | 39.01% | 27.05% | -11.96%p |
| **Sharpe** | 1.71 | 1.51 | -0.20 |
| **MDD** | -23.51% | -19.92% | +3.59%p |
| **ê±°ëž˜ ìˆ˜** | 1,440 | 1,406 | -34 |

### ë ˆì§ í†µê³„

| ë ˆì§ | ì¼ìˆ˜ | ë¹„ìœ¨ |
|------|------|------|
| ìƒìŠ¹ìž¥ | 232ì¼ | 48.2% |
| í•˜ë½ìž¥ | 114ì¼ | 23.7% |
| ì¤‘ë¦½ìž¥ | 135ì¼ | 28.1% |
| ë ˆì§ ë³€ê²½ | 5íšŒ | - |

### ë°©ì–´ ì‹œìŠ¤í…œ ìž‘ë™

| ì´ë²¤íŠ¸ | ë‚ ì§œ | ë‚´ìš© |
|--------|------|------|
| ì‹œìž¥ ê¸‰ë½ | 2024-08-05 | ë‹¨ì¼ ê¸‰ë½ -11.40% |
| ì‹œìž¥ ê¸‰ë½ | 2025-04-07 | ë‹¨ì¼ ê¸‰ë½ -6.14% |

---

## ðŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸

### ì„±ê³µ ìš”ì¸

1. **ì•ˆì •ì ì¸ ë ˆì§ ê°ì§€**
   - MA 50/200ì¼ì´ ê°€ìž¥ ì•ˆì •ì 
   - ë ˆì§ ë³€ê²½ 5íšŒ (ê³¼ë„í•œ ì „í™˜ ë°©ì§€)

2. **ê· í˜• ìž¡ížŒ í¬ì§€ì…˜ ë¹„ìœ¨**
   - ì¤‘ë¦½ìž¥ 80%: ê¸°íšŒ ì†ì‹¤ ìµœì†Œí™”
   - í•˜ë½ìž¥ 40~60%: ê³¼ë„í•œ ë°©ì–´ ë°©ì§€
   - CAGR 6%p íšŒë³µ

3. **ì™„í™”ëœ ë°©ì–´ ëª¨ë“œ**
   - ì‹ ë¢°ë„ 85% ì´ìƒë§Œ ë§¤ìˆ˜ ìŠ¤í‚µ
   - ë¶ˆí•„ìš”í•œ ê¸°íšŒ ì†ì‹¤ ê°ì†Œ

### ê°œì„  í•„ìš” ì‚¬í•­

1. **MDD ëª©í‘œ ë¯¸ë‹¬ì„±**
   - ëª©í‘œ: -12%, ë‹¬ì„±: -19.92%
   - 2022ë…„ í•˜ë½ìž¥ì—ì„œ í° ì†ì‹¤
   - ì¶”ê°€ ë°©ì–´ ë©”ì»¤ë‹ˆì¦˜ í•„ìš”

2. **CAGR ëª©í‘œ ë¯¸ë‹¬ì„±**
   - ëª©í‘œ: 30%, ë‹¬ì„±: 27.05%
   - ë°©ì–´ì  í¬ì§€ì…˜ìœ¼ë¡œ ì¸í•œ ê¸°íšŒ ì†ì‹¤
   - ë ˆë²„ë¦¬ì§€ ë˜ëŠ” ë” ê³µê²©ì ì¸ ì „ëžµ ê³ ë ¤

---

## ðŸ”§ ìµœì¢… ì„¤ì •

### ë ˆì§ ê°ì§€ íŒŒë¼ë¯¸í„°
```python
regime_short_ma = 50
regime_long_ma = 200
regime_bull_threshold = 0.02  # +2%
regime_bear_threshold = -0.02  # -2%
```

### í¬ì§€ì…˜ ë¹„ìœ¨
```python
# ìƒìŠ¹ìž¥
bull_position = 1.0 + (confidence - 0.5) * 0.4  # 100~120%

# ì¤‘ë¦½ìž¥
neutral_position = 0.8  # 80%

# í•˜ë½ìž¥
bear_position = 0.6 - (confidence - 0.5) * 0.4  # 40~60%

# ë°©ì–´ ëª¨ë“œ
defense_threshold = 0.85  # ì‹ ë¢°ë„ 85% ì´ìƒ
```

### ë°©ì–´ ì‹œìŠ¤í…œ
```python
# ì‹œìž¥ ê¸‰ë½ ê°ì§€
single_day_crash = -5.0%
short_term_crash = -7.0% / 3ì¼

# ë³€ë™ì„± ê´€ë¦¬
atr_period = 14
low_volatility_ratio = 1.2
high_volatility_ratio = 0.6

# ê°œë³„ ì†ì ˆ
fixed_stop_loss = ë¹„í™œì„±í™”
trailing_stop = ë¹„í™œì„±í™”
portfolio_stop_loss = ë¹„í™œì„±í™”
```

---

## ðŸ“ êµ¬í˜„ íŒŒì¼

### í•µì‹¬ ëª¨ë“ˆ
```
core/strategy/
â”œâ”€â”€ market_regime_detector.py    # ë ˆì§ ê°ì§€ ì‹œìŠ¤í…œ
â”œâ”€â”€ market_crash_detector.py     # ì‹œìž¥ ê¸‰ë½ ê°ì§€
â”œâ”€â”€ volatility_manager.py        # ë³€ë™ì„± ê´€ë¦¬
â””â”€â”€ defense_system.py            # ë°©ì–´ ì‹œìŠ¤í…œ í†µí•©

core/engine/
â””â”€â”€ krx_maps_adapter.py          # MAPS ë°±í…ŒìŠ¤íŠ¸ ì–´ëŒ‘í„°
```

### ë°±í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
```
scripts/phase2/
â”œâ”€â”€ run_backtest_hybrid.py       # í•˜ì´ë¸Œë¦¬ë“œ ì „ëžµ ë°±í…ŒìŠ¤íŠ¸
â”œâ”€â”€ run_backtest_volatility.py   # ë³€ë™ì„± ê´€ë¦¬ ë°±í…ŒìŠ¤íŠ¸
â”œâ”€â”€ run_backtest_crash.py        # ê¸‰ë½ ê°ì§€ ë°±í…ŒìŠ¤íŠ¸
â””â”€â”€ debug_regime.py              # ë ˆì§ ê°ì§€ ë””ë²„ê¹…
```

### ê²°ê³¼ íŒŒì¼
```
data/output/phase2/
â”œâ”€â”€ backtest_hybrid_summary.json     # í•˜ì´ë¸Œë¦¬ë“œ ì „ëžµ ê²°ê³¼
â”œâ”€â”€ hybrid_comparison.json           # ë¹„êµ ê²°ê³¼
â”œâ”€â”€ backtest_volatility_summary.json # ë³€ë™ì„± ê´€ë¦¬ ê²°ê³¼
â””â”€â”€ backtest_crash_summary.json      # ê¸‰ë½ ê°ì§€ ê²°ê³¼
```

---

## ðŸŽ“ í•™ìŠµ ë‚´ìš©

### ë ˆì§ ê°ì§€ì˜ ì¤‘ìš”ì„±
- ì‹œìž¥ ìƒí™©ì— ë”°ë¥¸ ë™ì  í¬ì§€ì…˜ ì¡°ì • í•„ìˆ˜
- ë„ˆë¬´ ë¹ ë¥¸ ë ˆì§ ì „í™˜ì€ ì˜¤ížˆë ¤ ì„±ëŠ¥ ì•…í™”
- ì•ˆì •ì ì¸ ë ˆì§ íŒë‹¨ì´ í•µì‹¬

### í¬ì§€ì…˜ ë¹„ìœ¨ì˜ ì˜í–¥
- ì¤‘ë¦½ìž¥ í¬ì§€ì…˜ì´ ì „ì²´ ì„±ê³¼ì— í° ì˜í–¥
- í•˜ë½ìž¥ì—ì„œë„ ì ì ˆí•œ í¬ì§€ì…˜ ìœ ì§€ í•„ìš”
- ê³¼ë„í•œ ë°©ì–´ëŠ” ê¸°íšŒ ì†ì‹¤ ì´ˆëž˜

### ë°±í…ŒìŠ¤íŠ¸ ë””ë²„ê¹…
- í†µê³„ ìˆ˜ì§‘ ë¡œì§ì˜ ì¤‘ìš”ì„±
- ê²°ê³¼ ë³€í™˜ ì‹œ ë°ì´í„° ì†ì‹¤ ì£¼ì˜
- ìƒì„¸ ë¡œê¹…ìœ¼ë¡œ ë¬¸ì œ ì¶”ì 

---

## ðŸš€ ë‹¤ìŒ ë‹¨ê³„: Week 4

### ëª©í‘œ
ìžë™í™” ì‹œìŠ¤í…œ êµ¬í˜„ìœ¼ë¡œ ì‹¤ì „ ìš´ì˜ ì¤€ë¹„

### ê³„íš
1. **Day 1**: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
2. **Day 2**: í…”ë ˆê·¸ëž¨ ì•Œë¦¼ ì‹œìŠ¤í…œ
3. **Day 3**: íŒŒë¼ë¯¸í„° ì¡°ì • UI ë° ë°±í…ŒìŠ¤íŠ¸ ížˆìŠ¤í† ë¦¬ ë·°ì–´

### ê¸°ëŒ€ íš¨ê³¼
- í‰ì¼ 5ë¶„, ì£¼ë§ 30ë¶„ íˆ¬ìžë¡œ ìš´ì˜ ê°€ëŠ¥
- UIì—ì„œ ì‹¤ì‹œê°„ íŒŒë¼ë¯¸í„° ì¡°ì •
- ë°±í…ŒìŠ¤íŠ¸ ížˆìŠ¤í† ë¦¬ ê¸°ë°˜ ìµœì í™”

---

## ðŸ“ ì°¸ê³  ìžë£Œ

### ê´€ë ¨ ë¬¸ì„œ
- `docs/WEEK1_JASON_INTEGRATION.md` - Week 1 ì™„ë£Œ ë³´ê³ ì„œ
- `docs/WEEK2_DEFENSE_SYSTEM.md` - Week 2 ì™„ë£Œ ë³´ê³ ì„œ
- `docs/HYBRID_STRATEGY_PLAN.md` - í•˜ì´ë¸Œë¦¬ë“œ ì „ëžµ ê³„íš

### ë°±í…ŒìŠ¤íŠ¸ ë¡œê·¸
- `logs/phase2/week3_hybrid_*.log` - ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë¡œê·¸

### ì½”ë“œ ë¦¬ë·°
- ëª¨ë“  ì½”ë“œëŠ” íƒ€ìž… ížŒíŠ¸ ë° docstring í¬í•¨
- ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… ì™„ë¹„
- í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ êµ¬ì¡°

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] MarketRegimeDetector í´ëž˜ìŠ¤ êµ¬í˜„
- [x] KRXMAPSAdapter í†µí•©
- [x] ë ˆì§ ê°ì§€ íŒŒë¼ë¯¸í„° ìµœì í™”
- [x] í¬ì§€ì…˜ ë¹„ìœ¨ ìµœì í™”
- [x] ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ê²€ì¦
- [x] ë””ë²„ê¹… ë° ë²„ê·¸ ìˆ˜ì •
- [x] ê²°ê³¼ ë¬¸ì„œí™”
- [x] ì½”ë“œ ì •ë¦¬ ë° ì£¼ì„ ì¶”ê°€

---

**Week 3 ì™„ë£Œ!** ðŸŽ‰

ë‹¤ìŒ: Week 4 - ìžë™í™” ì‹œìŠ¤í…œ êµ¬í˜„
