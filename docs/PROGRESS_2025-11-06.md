# 개발 진행 상황 - 2025-11-06

## 📋 오늘 완료된 작업

### 1. NAS 스케줄러 문제 해결 ✅

**문제**: 수동 실행은 되지만 작업 스케줄러에서 알림이 안 옴

**원인**:
- 스케줄 시간이 데이터 준비 전 (15:40 → 데이터 확정 전)
- PyKRX 데이터 확정 시간: 15:40~16:00

**해결**:
- EoD 신호: 15:40 → **16:00** 변경
- 레짐 변경: 16:00 → **16:30** 변경
- 환경 변수 설정 추가 (PATH, PYTHONPATH)

**생성 파일**:
- `docs/SCHEDULER_TIMING_GUIDE.md` - 스케줄 타이밍 가이드

---

### 2. 장중 알림 추가 (친구 스타일) ✅

**요구사항**: 1시간마다 급등/락 ETF 알림

**구현**:
- 네이버 금융 API 실시간 시세 조회
- 제외 키워드 필터링 (레버리지, 인버스, 채권 등)
- 3% 이상 상승 종목 자동 검색

**생성 파일**:
- `scripts/nas/rising_etf_alert.py` - 상승 ETF 알림
- `scripts/nas/market_open_alert.py` - 장 시작 알림
- `scripts/nas/regime_change_alert.py` - 레짐 변경 알림

**스케줄**: 평일 10:00~15:00, 매 1시간 (6회)

---

### 3. 알림 시스템 비교 분석 ✅

**친구 시스템 (jasonisdoing/momentum-etf) 분석**:
- APScheduler + Slack
- Streamlit 웹 대시보드
- 장 마감 후 자동 추천

**우리 시스템 강점**:
- ✅ 더 풍부한 알림 (7종)
- ✅ 레짐 감지 및 변경 알림
- ✅ 주간 리포트
- ✅ 장중 급등락 알림

**생성 파일**:
- `docs/NOTIFICATION_COMPARISON.md` - 알림 시스템 비교

---

### 4. 웹 대시보드 개발 (Phase 4-1) ✅

**기술 스택**: Streamlit + Plotly

**페이지 구성**:
1. **🏠 홈** - 주요 지표 요약
2. **💼 포트폴리오** - 현황 및 30일 성과
3. **📈 신호 히스토리** - 기간별 신호 조회
4. **📊 성과 분석** - 누적 수익률, 통계
5. **🌡️ 시장 레짐** - 레짐 상태 및 전략 가이드

**생성 파일**:
```
dashboard/
├── app.py                    # 메인 앱
├── README.md                 # 사용 가이드
└── pages/
    ├── home.py              # 홈
    ├── portfolio.py         # 포트폴리오
    ├── signals.py           # 신호 히스토리
    ├── performance.py       # 성과 분석
    └── regime.py            # 시장 레짐

requirements_dashboard.txt    # 의존성
```

**실행 방법**:
```bash
pip install -r requirements_dashboard.txt
streamlit run dashboard/app.py
```

---

### 5. 버그 수정 ✅

**문제**:
- `PerformanceTracker.get_performance_history()` 메서드 누락
- DataFrame 조건문 오류

**수정**:
- `get_performance_history()` 메서드 추가
- DataFrame 조건문 개선 (`if signals:` → `if len(signals) > 0:`)

---

## 📊 최종 스케줄러 구성

### 평일 스케줄

```
09:00 - 장 시작 알림 (포트폴리오 현황)
10:00 - 상승 ETF #1
11:00 - 상승 ETF #2
12:00 - 상승 ETF #3
13:00 - 상승 ETF #4
14:00 - 상승 ETF #5
15:00 - 상승 ETF #6
16:00 - EoD 신호 (변경)
16:30 - 레짐 변경 (변경)
```

### 매일 스케줄

```
02:00 - 로그 정리
03:00 - DB 백업
```

### 주말 스케줄

```
일요일 09:00 - 주간 리포트
```

---

## 🎯 Phase 완료 현황

### Phase 1: 데이터 수집 및 전처리 ✅
- PyKRX, FDR 데이터 수집
- Parquet 캐시 시스템

### Phase 2: 백테스트 및 최적화 ✅
- MAPS 전략 구현
- Optuna 파라미터 최적화
- 워크포워드 분석

### Phase 3: 실시간 운영 시스템 ✅
- Step 1: 실시간 신호 생성
- Step 2: 텔레그램 알림
- Step 3: 모니터링 및 로깅
- Step 4: NAS 배포 및 자동화

### Phase 4-1: 웹 대시보드 ✅
- Streamlit 대시보드 구현
- 5개 페이지 (홈, 포트폴리오, 신호, 성과, 레짐)

---

## 🚀 다음 Phase 계획

### Phase 4-2: Phase 2 재테스트 (예정)
- 긴 히스토리 ETF 선별
- Optuna 최적화 (50-100 trials)
- 워크포워드 분석
- 로버스트니스 테스트

### Phase 4-3: 전략 고도화 (예정)
- 다중 전략 조합
- 레짐별 파라미터 조정
- 동적 포지션 사이징

### Phase 4-4: 리스크 관리 강화 (예정)
- 손절매 로직
- 포트폴리오 리밸런싱
- 상관계수 기반 분산

### Phase 5: Oracle Cloud 배포 (신규) 🆕
- NAS 대신 Oracle Cloud 배포
- 클라우드 환경 설정
- 자동 스케일링

### Phase 6: 고급 웹 대시보드 (신규) 🆕
- 백테스트 실행 UI
- 전략 파라미터 설정 UI
- 룩백 기간 조정 UI
- 실시간 차트 및 알림

---

## 📁 생성된 주요 파일 (오늘)

### 알림 스크립트
- `scripts/nas/rising_etf_alert.py` - 상승 ETF 알림
- `scripts/nas/market_open_alert.py` - 장 시작 알림
- `scripts/nas/regime_change_alert.py` - 레짐 변경 알림

### 대시보드
- `dashboard/app.py` - 메인 앱
- `dashboard/pages/home.py` - 홈
- `dashboard/pages/portfolio.py` - 포트폴리오
- `dashboard/pages/signals.py` - 신호 히스토리
- `dashboard/pages/performance.py` - 성과 분석
- `dashboard/pages/regime.py` - 시장 레짐
- `requirements_dashboard.txt` - 의존성

### 문서
- `docs/SCHEDULER_TIMING_GUIDE.md` - 스케줄 타이밍 가이드
- `docs/NOTIFICATION_COMPARISON.md` - 알림 시스템 비교

---

## 🔧 수정된 파일

- `extensions/monitoring/tracker.py` - `get_performance_history()` 메서드 추가
- `dashboard/pages/signals.py` - DataFrame 조건문 수정
- `dashboard/pages/portfolio.py` - DataFrame 조건문 수정
- `dashboard/pages/performance.py` - DataFrame 조건문 수정

---

## 📝 Git Commit

```bash
git add .
git commit -m "Phase 4-1: 웹 대시보드 개발 완료

- Streamlit 기반 대시보드 구현 (5개 페이지)
- 장중 알림 추가 (상승 ETF, 장 시작, 레짐 변경)
- NAS 스케줄러 타이밍 수정
- 알림 시스템 비교 분석
- PerformanceTracker 메서드 추가
- DataFrame 조건문 버그 수정"

git push origin main
```

---

## 🎊 현재 상태

**완료**:
- ✅ Phase 1~3 완료
- ✅ Phase 4-1 웹 대시보드 완료
- ✅ 7종 알림 시스템 구축
- ✅ NAS 자동화 완료

**테스트 대기**:
- ⏳ NAS 스케줄러 실제 동작 확인
- ⏳ 대시보드 데이터 생성 및 확인

**다음 작업**:
- 📋 Phase 5: Oracle Cloud 배포 준비
- 📋 Phase 6: 고급 웹 대시보드 (백테스트 UI)
