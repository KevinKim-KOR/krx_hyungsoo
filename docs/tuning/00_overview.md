# íŠœë‹/ê²€ì¦ ì²´ê³„ ì„¤ê³„ - ê°œìš” (v2.1)

> **ì‘ì„±**: 2025-12-16  
> **ìµœì¢… ìˆ˜ì •**: 2025-12-17  
> **Author**: í˜•ìˆ˜  
> **ëª©ì **: íŠœë‹ íŒŒë¼ë¯¸í„° ìŠ¤í‚¤ë§ˆ í‘œì¤€í™” ë° ê²€ì¦ ì²´ê³„(Test ë´‰ì¸, Walk-Forward, ëª©ì í•¨ìˆ˜) ì„¤ê³„

```
ğŸ”’ Freeze ì„ ì–¸(v2.1): ë³¸ ë¬¸ì„œëŠ” êµ¬í˜„ ê¸°ì¤€ì„ ì´ë©°, ì´í›„ ë³€ê²½ì€
   (1) êµ¬í˜„ ëª¨í˜¸ì„±/ëª¨ìˆœ ë°œê²¬ ë˜ëŠ”
   (2) Walk-Forward ì‹¤í–‰ ê²°ê³¼ì™€ ë¬¸ì„œ ì •ì˜ ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•  ë•Œì—ë§Œ
   ë³€ê²½ ì‚¬ìœ Â·ì˜í–¥ ë²”ìœ„ë¥¼ í•¨ê»˜ ê¸°ë¡í•˜ê³  ë°˜ì˜í•œë‹¤.
```

---

## ë¬¸ì„œ êµ¬ì¡°

| íŒŒì¼ | ë‚´ìš© |
|------|------|
| **00_overview.md** | Changelog, ë°°ê²½/ë¬¸ì œ ì •ì˜, ì„¤ê³„ ì›ì¹™ |
| 01_metrics_guardrails.md | ì§€í‘œ ì •ì˜, ì´ìƒì¹˜ ê°ì§€, ë©€í‹° ë£©ë°± |
| 02_objective_gates.md | ëª©ì í•¨ìˆ˜, Live ìŠ¹ê²© ê²Œì´íŠ¸ |
| 03_walkforward_manifest.md | Walk-Forward, run_manifest |
| 04_implementation.md | ëˆ„ìˆ˜ ë°©ì§€, íŒŒë¼ë¯¸í„° ìŠ¤í‚¤ë§ˆ, UI/UX, ë¦¬ìŠ¤í¬, ë‹¤ìŒ ì•¡ì…˜ |

---

## Changelog

| ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|--------|---------|
| v1 | ì´ˆê¸° ì„¤ê³„ |
| v1.1 | Walk-Forward ìœˆë„ìš° ìˆ˜ì •, ë‹¨ìœ„ í†µì¼, ë©€í‹° ë£©ë°± ê²°í•©, ëˆ„ìˆ˜ ë°©ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸ |
| v1.2 | objective íë¦„ ì •ë¦¬, ì§€í‘œ ì •ì˜ ëª…ì‹œ, ê±°ë˜ì¼ ìŠ¤ëƒ…, ìºì‹œ ì„¤ê³„, Live ìŠ¹ê²© ê²Œì´íŠ¸, ì´ìƒì¹˜ ê°ì§€, ìƒì¡´í¸í–¥/ë°°ë‹¹ ì²˜ë¦¬ |
| v1.3 | Split ì¶©ëŒ ê·œì¹™, Test ê³„ì‚° ì‹œì , ë£©ë°± ì •ì˜(ê±°ë˜ì¼), stop_loss íŠ¸ë¦¬ê±° ê·œì¹™, ìºì‹œ í‚¤ ê°•í™” |
| v1.4 â†’ v2 | WF ìœˆë„ìš° ìŠ¤ëƒ… ê·œì¹™ ë°˜ì˜, Objective Test ë´‰ì¸ ê°•ì œ, exposure_ratio ì •ì˜ ëª…í™•í™”, stop_loss ë¹„ìš© ì™„ì „ ì ìš©, ë£©ë°± end_date ìŠ¤ëƒ…, manifest split_applied ì¶”ê°€, ìŠ¤ëƒ… í•¨ìˆ˜ ë¶„ë¦¬, WF/Holdout ê¸°ê°„ êµ¬ë¶„, ìºì‹œ í•´ì‹œ ì•ˆì •í™”, split_config í•„ë“œ í†µì¼, entry_price ì •ì˜ |
| **v2.1** | period êµ¬ì¡° í‘œì¤€í™”, BacktestRunResult ë„ì…, WF ìš©ì–´ êµ¬ë¶„(outsample) ë°˜ì˜, ìºì‹œ í‚¤ ê°•í™”, ë©€í‹° ë£©ë°± "ê°€ì§œ ë°˜ë³µ" ìˆ˜ì •, run_backtest ëª…ì¹­ í†µì¼, MDD ì¼ê´€ì„± Gate ê°•í™”, Logic Checks(RSI ì‹¤íš¨ì„±) ì¶”ê°€ |

```
âš ï¸ ë²„ì „ ì •ë¦¬:
   ê¸°ì¡´ v1.4ëŠ” ë‚´ìš©ìƒ v2ë¡œ ìŠ¹ê²©,
   v2.1ì€ êµ¬ì¡° ì •ë¹„ ë° ì½”ë“œ ì¼ê´€ì„± íŒ¨ì¹˜ ë²„ì „ì…ë‹ˆë‹¤.
```

---

## ìš©ì–´ êµ¬ë¶„

```
âš ï¸ ìš©ì–´ êµ¬ë¶„:
   - **Holdout Test**: ìµœì¢… ë´‰ì¸(Test ë´‰ì¸ ëŒ€ìƒ, Gate3ì—ì„œë§Œ ê³„ì‚°)
   - **Walk-Forward Out-of-Sample**: Gate2 ì•ˆì •ì„± í‰ê°€ìš© (ê³„ì‚° í—ˆìš©)
     - Walk-Forward ë‚´ë¶€ì—ì„œëŠ” `outsample` ìš©ì–´ë¥¼ ì‚¬ìš© ê¶Œì¥
```

---

## 1. ë°°ê²½ / ë¬¸ì œ ì •ì˜

### 1.1 í˜„ì¬ ìƒí™©

| í•­ëª© | í˜„ì¬ ìƒíƒœ |
|------|----------|
| í™œì„± íŠœë‹ ë³€ìˆ˜ | ma_period, rsi_period, stop_loss (3ê°œ) |
| ë¹„í™œì„± í›„ë³´ | volatility_filter, market_breadth, rsi_overbought, rsi_oversold, rebalance_threshold |
| íŠœë‹ ë°©ì‹ | Optuna ë²”ìœ„ íƒìƒ‰ (ë‹¨ì¼ ë°±í…ŒìŠ¤íŠ¸ ì•„ë‹˜) |
| ê²€ì¦ ë¶„í•  | Train 70% / Val 15% / Test 15% |

### 1.2 í•µì‹¬ ë¬¸ì œ

**ë°˜ë³µë˜ëŠ” íŒ¨í„´:**
```
Train Sharpe: ë†’ìŒ (2.0+)
Val Sharpe: 0 ì´í•˜ / ë¶€ì§„
Test Sharpe: ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ìŒ (1.5+)
```

**ì›ì¸ ë¶„ì„:**
1. **Test ë°ì´í„° ëˆ„ìˆ˜**: íŠœë‹ ì„ íƒ ì‹œ Test ì„±ê³¼ë¥¼ ì°¸ì¡°í•˜ë©´ ì‚¬ì‹¤ìƒ Testë¡œ ìµœì í™”í•œ ê²ƒ
2. **ë‹¨ì¼ ë¶„í• ì˜ í•œê³„**: íŠ¹ì • ê¸°ê°„ì— ìš´ ì¢‹ê²Œ ë§ëŠ” íŒŒë¼ë¯¸í„°ê°€ ì„ íƒë¨
3. **Val êµ¬ê°„ ì§§ìŒ**: 15%ëŠ” ì•½ 2~3ê°œì›”, ë…¸ì´ì¦ˆì— ì·¨ì•½
4. **ëª©ì í•¨ìˆ˜ ë‹¨ìˆœ**: Sharpeë§Œ ìµœëŒ€í™” â†’ ê³¼ì í•© ìœ ë„
5. **ê±°ë˜ ë¶€ì¡± ì‹œ Sharpe ì™œê³¡**: ê±°ë˜ê°€ ì ìœ¼ë©´ ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ì€ Sharpe ë°œìƒ

### 1.3 í•´ê²° ë°©í–¥

| ë¬¸ì œ | í•´ê²°ì±… |
|------|--------|
| Test ëˆ„ìˆ˜ | **Test ë´‰ì¸** â€” ì„ íƒ/ì •ë ¬ì— ì‚¬ìš© ê¸ˆì§€ |
| ë‹¨ì¼ ë¶„í•  í•œê³„ | **ë¯¸ë‹ˆ Walk-Forward** â€” ë¡¤ë§ ê²€ì¦ |
| Val ì§§ìŒ | **ìµœì†Œ ê°œì›”ìˆ˜ ê·œì¹™** (Val â‰¥ 6M, Test â‰¥ 6M) |
| ê³¼ì í•© | **ë³µí•© ëª©ì í•¨ìˆ˜** â€” Val ê¸°ë°˜ + ì•ˆì •ì„± í˜ë„í‹° + ê°€ë“œë ˆì¼ |
| ì¬í˜„ì„± | **run_manifest** â€” ëª¨ë“  ì‹¤í–‰ ì¡°ê±´ ì €ì¥ (seed í¬í•¨) |
| ëˆ„ìˆ˜ | **ì²´í¬ë¦¬ìŠ¤íŠ¸** â€” ì‹ í˜¸/ì²´ê²° ì‹œì , ê²°ì¸¡ ì²˜ë¦¬ ë“± |
| ì´ìƒì¹˜ | **ì´ìƒì¹˜ ê°ì§€ ë ˆì´ë”** â€” Sharpe/CAGR/í‘œë³¸ìˆ˜ ê¸°ë°˜ ê²½ê³  |

---

## 2. ì„¤ê³„ ì›ì¹™

### 2.1 ê²€ì¦ ë´‰ì¸ ì›ì¹™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Train (70%)  â”‚  Val (15%)  â”‚  Test (15%)                  â”‚
â”‚               â”‚             â”‚                              â”‚
â”‚  í•™ìŠµ/íƒìƒ‰    â”‚  ì„ íƒ ê¸°ì¤€  â”‚  ìµœì¢… ë³´ê³ ì„œì—ì„œë§Œ ì—´ëŒ      â”‚
â”‚               â”‚             â”‚  (ì„ íƒ/ì •ë ¬/ìµœì í™” ê¸ˆì§€)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê°•ì œ ê·œì¹™:**
- Optuna objective = Val ì„±ê³¼ë§Œ ì‚¬ìš©
- UI ê²°ê³¼ í…Œì´ë¸” ì •ë ¬ = Val Sharpe ê¸°ì¤€
- Test ì»¬ëŸ¼ì€ "ìµœì¢… ë¦¬í¬íŠ¸" íƒ­ì—ì„œë§Œ í‘œì‹œ

**Test ê³„ì‚° ì‹œì :**

```
âš ï¸ ì ˆëŒ€ ê·œì¹™: íŠœë‹ ì¤‘ì—ëŠ” Test ìì²´ë¥¼ ê³„ì‚°í•˜ì§€ ì•ŠëŠ”ë‹¤.
   Gate 2 í†µê³¼ í›„ì—ë§Œ Test ë°±í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•œë‹¤.
   (UIì—ì„œ ìˆ¨ê¸°ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ëˆ„ìˆ˜ë¥¼ ëª» ë§‰ìŒ - ë¡œê·¸ë¡œ ë³¼ ìˆ˜ ìˆìŒ)
```

| ë‹¨ê³„ | Test ê³„ì‚° | ì´ìœ  |
|------|----------|------|
| íŠœë‹ ì¤‘ (Optuna) | âŒ ê³„ì‚° ì•ˆ í•¨ | ë¡œê·¸ë¡œë„ ëˆ„ìˆ˜ ë°©ì§€ |
| Gate 1 (Val Top-N) | âŒ ê³„ì‚° ì•ˆ í•¨ | ì„ íƒ ê¸°ì¤€ì— ì˜í–¥ ë°©ì§€ |
| Gate 2 (WF ì•ˆì •ì„±) | âŒ ê³„ì‚° ì•ˆ í•¨ | ì•ˆì •ì„± í‰ê°€ì— ì˜í–¥ ë°©ì§€ |
| Gate 2 í†µê³¼ í›„ | âœ… ê³„ì‚° | ìµœì¢… ë³´ê³ ì„œìš© |

**êµ¬í˜„:**
```python
def run_backtest_for_tuning(params, period, costs):
    """
    íŠœë‹ìš© ë°±í…ŒìŠ¤íŠ¸: Train/Valë§Œ ê³„ì‚°
    """
    train_result = backtest(params, period['train'], costs=costs)
    val_result = backtest(params, period['val'], costs=costs)
    # âŒ TestëŠ” ê³„ì‚°í•˜ì§€ ì•ŠìŒ
    return {'train': train_result, 'val': val_result, 'test': None}

def run_backtest_for_final(params, period, costs):
    """
    ìµœì¢… ë³´ê³ ì„œìš© ë°±í…ŒìŠ¤íŠ¸: Test í¬í•¨ (Gate 2 í†µê³¼ í›„ì—ë§Œ í˜¸ì¶œ)
    """
    train_result = backtest(params, period['train'], costs=costs)
    val_result = backtest(params, period['val'], costs=costs)
    test_result = backtest(params, period['test'], costs=costs)
    return {'train': train_result, 'val': val_result, 'test': test_result}
```

### 2.2 Chronological Split ê°•ì œ

```
âš ï¸ ì ˆëŒ€ ê·œì¹™: Splitì€ ë°˜ë“œì‹œ ì‹œê°„ ìˆœì„œ(ê³¼ê±°â†’ë¯¸ë˜)ë¡œ ìˆ˜í–‰í•œë‹¤.
   ëœë¤ ë¶„í• ì€ ê¸ˆì§€. ë¯¸ë˜ ë°ì´í„°ê°€ Trainì— ì„ì´ë©´ ëˆ„ìˆ˜ ë°œìƒ.
```

**Split ê·œì¹™:**
```python
# âœ… ì˜¬ë°”ë¥¸ ë¶„í•  (Chronological)
data = data.sort_values('date')
train = data[:int(len(data) * 0.70)]
val   = data[int(len(data) * 0.70):int(len(data) * 0.85)]
test  = data[int(len(data) * 0.85):]

# âŒ ê¸ˆì§€ (Random)
train, val, test = random_split(data, [0.70, 0.15, 0.15])
```

### 2.3 ìµœì†Œ ê¸°ê°„ ê·œì¹™ ë° Split ì¶©ëŒ í•´ê²°

**Holdout Split vs Mini Walk-Forward ê¸°ê°„ êµ¬ë¶„:**

```
âš ï¸ Holdout Split(Train/Val/Test)ì€ Val/Test ê¸°ë³¸ 6M
   Mini Walk-Forwardì˜ val/testëŠ” 3M (ë¹ ë¥¸ ì•ˆì •ì„± ì²´í¬ìš©)
```

| ìš©ë„ | Val ê¸°ê°„ | Test ê¸°ê°„ | ë¹„ê³  |
|------|----------|----------|------|
| **Holdout Split** | 6ê°œì›” | 6ê°œì›” | ìµœì¢… í‰ê°€ìš© |
| **Mini Walk-Forward** | 3ê°œì›” | 3ê°œì›” | ë¹ ë¥¸ ì•ˆì •ì„± ì²´í¬ |

| êµ¬ê°„ | ê¸°ë³¸ê°’ (Holdout) | ì˜ˆì™¸ (ì „ì²´ ê¸°ê°„ ì§§ì„ ë•Œ) |
|------|-----------------|-------------------------|
| Val | **6ê°œì›” ì´ìƒ** | ìµœì†Œ 4ê°œì›” (ê²½ê³  í‘œì‹œ) |
| Test | **6ê°œì›” ì´ìƒ** | ìµœì†Œ 4ê°œì›” (ê²½ê³  í‘œì‹œ) |
| Train | **ë‚˜ë¨¸ì§€** | ìµœì†Œ 8ê°œì›” (ê²½ê³  í‘œì‹œ) |

**Split ë¹„ìœ¨ vs ìµœì†Œê°œì›” ì¶©ëŒ í•´ê²° ê·œì¹™:**

```
âš ï¸ ì ˆëŒ€ ê·œì¹™: ìµœì†Œê°œì›” ìš°ì„ , ë¹„ìœ¨ì€ ëª©í‘œì¹˜
   Val = 6ê°œì›”, Test = 6ê°œì›”, Train = ë‚˜ë¨¸ì§€
   ê¸°ê°„ì´ ì§§ìœ¼ë©´ ì˜ˆì™¸ + ê²½ê³  í‘œì‹œ
```

**ì˜ˆì‹œ (24ê°œì›” ê¸°ê°„):**
- 70/15/15 ë¹„ìœ¨ ì ìš© ì‹œ: Val=3.6ê°œì›”, Test=3.6ê°œì›” â†’ ìµœì†Œê°œì›” ë¯¸ë‹¬
- **ì‹¤ì œ ì ìš©**: Val=6ê°œì›”, Test=6ê°œì›”, Train=12ê°œì›” (ë‚˜ë¨¸ì§€)

**Split ê³„ì‚° ë¡œì§:**
```python
def calculate_split(total_months, min_val=6, min_test=6, min_train=8):
    """
    ìµœì†Œê°œì›” ìš°ì„  Split ê³„ì‚°
    """
    # 1. ìµœì†Œ ê¸°ê°„ í™•ë³´ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
    required = min_val + min_test + min_train
    if total_months < required:
        # ì˜ˆì™¸ ëª¨ë“œ: 4/4/8 ìµœì†Œê°’
        if total_months < 16:
            raise ValueError(f"ì „ì²´ ê¸°ê°„ì´ 16ê°œì›” ë¯¸ë§Œì…ë‹ˆë‹¤: {total_months}ê°œì›”")
        val_months = 4
        test_months = 4
        train_months = total_months - val_months - test_months
        warnings.append("âš ï¸ Val/Testê°€ ìµœì†Œê°’(4ê°œì›”)ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
    else:
        # ì •ìƒ ëª¨ë“œ: 6/6/ë‚˜ë¨¸ì§€
        val_months = min_val
        test_months = min_test
        train_months = total_months - val_months - test_months
    
    return train_months, val_months, test_months
```

### 2.4 ë‹¨ìœ„ í†µì¼ ì›ì¹™

```
âš ï¸ ì ˆëŒ€ ê·œì¹™: ì—”ì§„/manifest ë‚´ë¶€ëŠ” ì†Œìˆ˜(0~1), UI í‘œì‹œë§Œ %
```

| ì§€í‘œ | ë‚´ë¶€ ì €ì¥ (ì†Œìˆ˜) | UI í‘œì‹œ (%) |
|------|-----------------|-------------|
| CAGR | 0.25 | 25% |
| MDD | -0.12 | -12% |
| stop_loss | -0.10 | -10% |
| commission | 0.00015 | 0.015% |
| slippage | 0.001 | 0.1% |
| Sharpe | 1.5 (ë¬´ë‹¨ìœ„) | 1.5 |

### 2.5 ê±°ë˜ì¼ ìŠ¤ëƒ… ê·œì¹™

```
âš ï¸ ì‹œì‘ì¼ì€ ë‹¤ìŒ ì˜ì—…ì¼ë¡œ, ì¢…ë£Œì¼ì€ ì´ì „ ì˜ì—…ì¼ë¡œ ìŠ¤ëƒ…í•œë‹¤.
   (ì‹œì‘ì¼ì„ ì´ì „ ì˜ì—…ì¼ë¡œ ìŠ¤ëƒ…í•˜ë©´ ê¸°ê°„ ë°–ìœ¼ë¡œ íŠ€ëŠ” ì‚¬ê³  ë°œìƒ)
```

**ìŠ¤ëƒ… í•¨ìˆ˜ ë¶„ë¦¬:**
```python
def snap_start(date, trading_calendar):
    """ì‹œì‘ì¼: íœ´ì¥ì¼ì´ë©´ ë‹¤ìŒ ì˜ì—…ì¼ë¡œ ìŠ¤ëƒ…"""
    while date not in trading_calendar:
        date = date + timedelta(days=1)  # ë‹¤ìŒ ì˜ì—…ì¼
    return date

def snap_end(date, trading_calendar):
    """ì¢…ë£Œì¼: íœ´ì¥ì¼ì´ë©´ ì´ì „ ì˜ì—…ì¼ë¡œ ìŠ¤ëƒ…"""
    while date not in trading_calendar:
        date = date - timedelta(days=1)  # ì´ì „ ì˜ì—…ì¼
    return date

# ì˜ˆì‹œ:
# 2024-01-01(íœ´ì¥) ì‹œì‘ì¼ â†’ 2024-01-02ë¡œ ìŠ¤ëƒ… (ë‹¤ìŒ ì˜ì—…ì¼)
# 2025-06-30(íœ´ì¥) ì¢…ë£Œì¼ â†’ 2025-06-27ë¡œ ìŠ¤ëƒ… (ì´ì „ ì˜ì—…ì¼)
```

**ì˜ëª»ëœ ì˜ˆì‹œ (ê¸°ê°„ ë°–ìœ¼ë¡œ íŠ€ëŠ” ì‚¬ê³ ):**
```python
# âŒ ì‹œì‘ì¼ì„ ì´ì „ ì˜ì—…ì¼ë¡œ ìŠ¤ëƒ…í•˜ë©´:
# 2024-01-01(íœ´ì¥) â†’ 2023-12-29ë¡œ ìŠ¤ëƒ… â†’ ê¸°ê°„ ë°–!
```

### 2.6 íƒìƒ‰ ê³µê°„ ì œì–´ ì›ì¹™

```
í™œì„± ë³€ìˆ˜ ìˆ˜ Ã— ê° ë³€ìˆ˜ step ìˆ˜ = íƒìƒ‰ ê³µê°„
```

**ì˜ˆì‹œ:**
- ma_period: (200-20)/10 = 18ê°œ
- rsi_period: (30-5)/1 = 25ê°œ
- stop_loss: (20-5)/1 = 15ê°œ
- **ì´ ì¡°í•©: 18 Ã— 25 Ã— 15 = 6,750ê°œ**

**íƒìƒ‰ ì»¤ë²„ë¦¬ì§€:**
```
Trials = 50ì¼ ë•Œ, ì»¤ë²„ë¦¬ì§€ â‰ˆ 50 / 6,750 = 0.7%
â†’ "ì „ìˆ˜ì¡°ì‚¬ê°€ ì•„ë‹Œ ìƒ˜í”Œë§ íƒìƒ‰"ì„ì„ UIì— ëª…ì‹œ
```
