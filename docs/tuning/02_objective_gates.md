# íŠœë‹/ê²€ì¦ ì²´ê³„ ì„¤ê³„ - ëª©ì í•¨ìˆ˜ ë° ìŠ¹ê²© ê²Œì´íŠ¸ (v2.1)

> ê´€ë ¨ ë¬¸ì„œ: [00_overview.md](./00_overview.md)

---

## 6. ëª©ì í•¨ìˆ˜(Objective) ì„¤ê³„

### 6.1 Objective íë¦„

```
âš ï¸ trialì€ Optuna ê°ì²´, paramsëŠ” íŒŒë¼ë¯¸í„° dict.
   run_backtest()ëŠ” paramsë¥¼ ë°›ëŠ”ë‹¤. trialì„ ì§ì ‘ ë„˜ê¸°ì§€ ì•ŠëŠ”ë‹¤.
```

**ì˜¬ë°”ë¥¸ íë¦„ (v2.1: Test ë´‰ì¸ ê°•ì œ):**
```python
def objective(trial, lookbacks=[3, 6, 12], period=None):
    """
    v2.1 ì ˆëŒ€ ê·œì¹™:
    - objectiveì—ì„œëŠ” Testë¥¼ ê³„ì‚°í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - ë°˜ë“œì‹œ run_backtest_for_tuning()ë§Œ í˜¸ì¶œí•œë‹¤.
    """
    params = {
        'ma_period': trial.suggest_int('ma_period', 20, 200, step=10),
        'rsi_period': trial.suggest_int('rsi_period', 5, 30),
        'stop_loss': trial.suggest_float('stop_loss', -0.20, -0.05, step=0.01),
    }

    scores = []
    for lb in lookbacks:
        result = run_backtest_for_tuning(
            params=params,
            period=period,            # train/val êµ¬ê°„ë§Œ í¬í•¨
            costs=DEFAULT_COSTS
        )

        if not check_guardrails(result):
            return -999

        score = calculate_score(result)
        scores.append(score)

    return min(scores)
```

### 6.2 ê°€ë“œë ˆì¼ ì²´í¬ í•¨ìˆ˜

```python
def check_guardrails(result):
    """
    ê°€ë“œë ˆì¼ í†µê³¼ ì—¬ë¶€ í™•ì¸
    í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ False
    """
    if result.num_trades < 30:
        return False
    if result.exposure_ratio < 0.30:
        return False
    if result.annual_turnover > 24:
        return False
    return True
```

### 6.3 ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜

```python
def calculate_score(result):
    """
    Val ê¸°ë°˜ ì ìˆ˜ ê³„ì‚° (MDD í˜ë„í‹° í¬í•¨)
    """
    val_sharpe = result.val_sharpe
    val_mdd = result.val_mdd  # ì†Œìˆ˜ (ì˜ˆ: -0.12)
    
    # MDD í˜ë„í‹°: 15% ì´ˆê³¼ ì‹œ
    mdd_threshold = 0.15
    mdd_penalty = max(0, abs(val_mdd) - mdd_threshold) * 10
    
    return val_sharpe - mdd_penalty
```

### 6.4 ê±°ë˜ë¹„ìš© ê¸°ë³¸ ì ìš©

```
âš ï¸ ì ˆëŒ€ ê·œì¹™: ê±°ë˜ë¹„ìš©ì€ "ì˜µì…˜"ì´ ì•„ë‹ˆë¼ "ê¸°ë³¸ê°’"ìœ¼ë¡œ í•­ìƒ ì ìš©.
   ë¹„ìš© ì—†ì´ íŠœë‹í•˜ë©´ Testì—ì„œ ì„±ê³¼ê°€ ê¸‰ë½í•˜ëŠ” "ì‹ ë‚´ë¦¼" í˜„ìƒ ë°œìƒ.
```

```python
DEFAULT_COSTS = {
    'commission_rate': 0.00015,  # 0.015% (í¸ë„)
    'slippage_rate': 0.001,      # 0.1% (í¸ë„)
}

# ë¹„ìš©ì€ í•­ìƒ ì ìš©
result = run_backtest(params, costs=DEFAULT_COSTS)
```

---

## 7. Live ìŠ¹ê²© ê²Œì´íŠ¸

### 7.1 ìŠ¹ê²© í”„ë¡œì„¸ìŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Live ìŠ¹ê²© ê²Œì´íŠ¸                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Gate 1: Val ê¸°ì¤€ Top-N ì„ ì •                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  - Val Sharpe ê¸°ì¤€ ìƒìœ„ Nê°œ (ê¸°ë³¸ N=5)                                 â”‚
â”‚  - ê°€ë“œë ˆì¼ í†µê³¼ í•„ìˆ˜                                                   â”‚
â”‚  - ì´ìƒì¹˜ ê²½ê³ (ğŸ”´) ì—†ì–´ì•¼ í•¨                                           â”‚
â”‚                                                                         â”‚
â”‚                              â†“                                          â”‚
â”‚                                                                         â”‚
â”‚  Gate 2: Walk-Forward ì•ˆì •ì„± í†µê³¼                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  - ë¯¸ë‹ˆ Walk-Forward ì‹¤í–‰ (3~5ê°œ ìœˆë„ìš°)                               â”‚
â”‚  - stability_score â‰¥ 1.0                                               â”‚
â”‚  - win_rate â‰¥ 60% (Sharpe > 0ì¸ ìœˆë„ìš° ë¹„ìœ¨)                           â”‚
â”‚                                                                         â”‚
â”‚                              â†“                                          â”‚
â”‚                                                                         â”‚
â”‚  Gate 3: Test ê³µê°œ + Live í›„ë³´ ë“±ë¡                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  - Gate 1, 2 í†µê³¼í•œ Trialë§Œ Test ì„±ê³¼ ê³µê°œ                             â”‚
â”‚  - Live ì ìš© í›„ë³´ë¡œ ë“±ë¡                                                â”‚
â”‚  - ìµœì¢… ì„ íƒì€ ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ                                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ê²Œì´íŠ¸ í†µê³¼ ì¡°ê±´

| ê²Œì´íŠ¸ | ì¡°ê±´ | í†µê³¼ ê¸°ì¤€ |
|--------|------|----------|
| Gate 1 | Val Top-N | Val Sharpe ìƒìœ„ 5ê°œ |
| Gate 1 | ê°€ë“œë ˆì¼ | num_trades â‰¥ 30, exposure â‰¥ 30%, turnover â‰¤ 24 |
| Gate 1 | ì´ìƒì¹˜ | ğŸ”´ ê²½ê³  ì—†ìŒ |
| Gate 2 | ì•ˆì •ì„± ì ìˆ˜ | stability_score â‰¥ 1.0 |
| Gate 2 | ìŠ¹ë¥  | win_rate â‰¥ 60% |
| Gate 3 | ìµœì¢… í™•ì¸ | ì‚¬ìš©ì ìˆ˜ë™ ì„ íƒ |

### 7.3 UI í‘œì‹œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Live ìŠ¹ê²© í›„ë³´                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âœ… Trial #1 â€” Gate 1, 2 í†µê³¼                                          â”‚
â”‚     Val Sharpe: 1.5 | ì•ˆì •ì„±: 1.8 | ìŠ¹ë¥ : 80%                          â”‚
â”‚     [Test í™•ì¸] [Live ì ìš©]                                            â”‚
â”‚                                                                         â”‚
â”‚  âœ… Trial #5 â€” Gate 1, 2 í†µê³¼                                          â”‚
â”‚     Val Sharpe: 1.3 | ì•ˆì •ì„±: 1.2 | ìŠ¹ë¥ : 60%                          â”‚
â”‚     [Test í™•ì¸] [Live ì ìš©]                                            â”‚
â”‚                                                                         â”‚
â”‚  â¸ï¸ Trial #2 â€” Gate 2 ëŒ€ê¸° (ì•ˆì •ì„± ê²€ì¦ í•„ìš”)                          â”‚
â”‚     Val Sharpe: 1.4 | [ì•ˆì •ì„± ê²€ì¦ ì‹¤í–‰]                               â”‚
â”‚                                                                         â”‚
â”‚  âŒ Trial #3 â€” Gate 1 íƒˆë½ (ì´ìƒì¹˜ ê²½ê³ )                               â”‚
â”‚     Val Sharpe: 2.0 | ğŸ”´ Sharpeâ†‘â†‘                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
